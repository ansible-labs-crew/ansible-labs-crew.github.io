<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.69.0" />
    <meta name="description" content="Ansible and Ansible Automation Platform Labs">
<meta name="author" content="Christian, Eric, Götz">

    <link rel="icon" href="https://ansible-labs-crew.github.io/images/favicon.png" type="image/png">

    <title>Writing Your First Playbook :: Ansible Labs for Red Hat Summit 2021</title>

    
    <link href="https://ansible-labs-crew.github.io/css/nucleus.css?1632505063" rel="stylesheet">
    <link href="https://ansible-labs-crew.github.io/css/fontawesome-all.min.css?1632505063" rel="stylesheet">
    <link href="https://ansible-labs-crew.github.io/css/hybrid.css?1632505063" rel="stylesheet">
    <link href="https://ansible-labs-crew.github.io/css/featherlight.min.css?1632505063" rel="stylesheet">
    <link href="https://ansible-labs-crew.github.io/css/perfect-scrollbar.min.css?1632505063" rel="stylesheet">
    <link href="https://ansible-labs-crew.github.io/css/auto-complete.css?1632505063" rel="stylesheet">
    <link href="https://ansible-labs-crew.github.io/css/atom-one-dark-reasonable.css?1632505063" rel="stylesheet">
    <link href="https://ansible-labs-crew.github.io/css/theme.css?1632505063" rel="stylesheet">
    <link href="https://ansible-labs-crew.github.io/css/tabs.css?1632505063" rel="stylesheet">
    <link href="https://ansible-labs-crew.github.io/css/hugo-theme.css?1632505063" rel="stylesheet">
    
    <link href="https://ansible-labs-crew.github.io/css/theme-red.css?1632505063" rel="stylesheet">
    
    

    <script src="https://ansible-labs-crew.github.io/js/jquery-3.3.1.min.js?1632505063"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
        :not(pre) > code + span.copy-to-clipboard {
            display: none;
        }
      
    </style>
    
  </head>
  <body class="" data-url="/ansible-getting-started/3-playbook/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="https://ansible-labs-crew.github.io/">
  <img src="https://ansible-labs-crew.github.io/images/summit-2021.png">
</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="https://ansible-labs-crew.github.io/js/lunr.min.js?1632505063"></script>
<script type="text/javascript" src="https://ansible-labs-crew.github.io/js/auto-complete.js?1632505063"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/ansible-labs-crew.github.io\/";
    
</script>
<script type="text/javascript" src="https://ansible-labs-crew.github.io/js/search.js?1632505063"></script>

    
  </div>
  
    <section id="homelinks">
      <ul>
        <li>
            <a class="padding" href='https://ansible-labs-crew.github.io/'><i class='fas fa-home'></i> Home</a>
        </li>
      </ul>
    </section>
  

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/ansible-getting-started/" title="Ansible Getting Started" class="dd-item
        parent
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-getting-started/">
          Ansible Getting Started
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/ansible-getting-started/1-setup/" title="Check the Prerequisites" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-getting-started/1-setup/">
          Check the Prerequisites
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-getting-started/2-adhoc/" title="Running ad hoc commands" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-getting-started/2-adhoc/">
          Running ad hoc commands
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-getting-started/3-playbook/" title="Writing Your First Playbook" class="dd-item
        
        active
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-getting-started/3-playbook/">
          Writing Your First Playbook
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-getting-started/4-variables/" title="Using Variables" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-getting-started/4-variables/">
          Using Variables
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-getting-started/5-handlers/" title="Conditionals, Handlers and Loops" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-getting-started/5-handlers/">
          Conditionals, Handlers and Loops
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-getting-started/6-templates/" title="Templates" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-getting-started/6-templates/">
          Templates
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-getting-started/7-bonus/" title="Bonus Labs" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-getting-started/7-bonus/">
          Bonus Labs
          
      </a>
      
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ansible-controller-getting-started/" title="Ansible automation controller getting started" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-getting-started/">
          Ansible automation controller getting started
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-getting-started/1-intro/" title="Introduction to automation controller" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-getting-started/1-intro/">
          Introduction to automation controller
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-getting-started/2-cred/" title="Inventories, credentials and ad hoc commands" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-getting-started/2-cred/">
          Inventories, credentials and ad hoc commands
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-getting-started/3-projects/" title="Projects &amp; job templates" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-getting-started/3-projects/">
          Projects &amp; job templates
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-getting-started/4-surveys/" title="Surveys" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-getting-started/4-surveys/">
          Surveys
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-getting-started/5-rbac/" title="Role-based access control" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-getting-started/5-rbac/">
          Role-based access control
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-getting-started/6-workflows/" title="Workflows" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-getting-started/6-workflows/">
          Workflows
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-getting-started/7-wrap/" title="Wrap up" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-getting-started/7-wrap/">
          Wrap up
          
      </a>
      
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ansible-controller-advanced/" title="Ansible automation controller advanced" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-advanced/">
          Ansible automation controller advanced
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-advanced/1-intro/" title="Introduction to your lab" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-advanced/1-intro/">
          Introduction to your lab
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-advanced/2-clustering/" title="Introduction to automation controller clustering" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-advanced/2-clustering/">
          Introduction to automation controller clustering
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-advanced/3-awx-collection-intro/" title="There is more to automation controller than the Web UI" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-advanced/3-awx-collection-intro/">
          There is more to automation controller than the Web UI
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-advanced/4-cluster-jobs/" title="Primer on Execution Environments: Running Jobs in a Cluster" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-advanced/4-cluster-jobs/">
          Primer on Execution Environments: Running Jobs in a Cluster
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-advanced/5-instance-groups/" title="automation controller instance groups" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-advanced/5-instance-groups/">
          automation controller instance groups
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-advanced/6-parallel-jobs/" title="Parallel Jobs" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-advanced/6-parallel-jobs/">
          Parallel Jobs
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-advanced/7-advanced-inventories/" title="Advanced Inventories" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-advanced/7-advanced-inventories/">
          Advanced Inventories
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-advanced/8-structured-content/" title="Well Structured Content Repositories" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-advanced/8-structured-content/">
          Well Structured Content Repositories
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-advanced/9-rest-api/" title="Discovering the automation controller API" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-advanced/9-rest-api/">
          Discovering the automation controller API
          
      </a>
      
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ansible-collections/" title="Ansible Collections" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-collections/">
          Ansible Collections
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/ansible-collections/1-introduction/" title="Introduction" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-collections/1-introduction/">
          Introduction
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-collections/2-using-collections-from-playbooks/" title="Collections from Playbook" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-collections/2-using-collections-from-playbooks/">
          Collections from Playbook
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-collections/3-using-collections-from-roles/" title="Collections from Roles" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-collections/3-using-collections-from-roles/">
          Collections from Roles
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-collections/4-using-collections-from-tower/" title="Collections in automation controller" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-collections/4-using-collections-from-tower/">
          Collections in automation controller
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-collections/5-creating-collections/" title="Creating Collections" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-collections/5-creating-collections/">
          Creating Collections
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-collections/6-automation-hub-and-galaxy/" title="Use Automation Hub" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-collections/6-automation-hub-and-galaxy/">
          Use Automation Hub
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/ansible-collections/6-automation-hub-and-galaxy/screenshots/" title="" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-collections/6-automation-hub-and-galaxy/screenshots/">
          
          
      </a>
      
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vscode-intro/" title="Visual Studio Code - Introduction" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/vscode-intro/">
          Visual Studio Code - Introduction
          
      </a>
      
      
    </li>
  
 

          
        
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li>
                  <a class="padding" href="https://goetzrieger.github.io/"><i class='fas fa-home'></i> Homepage</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="footer">
      <p></p>
    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='https://ansible-labs-crew.github.io/'></a> > <a href='https://ansible-labs-crew.github.io/ansible-getting-started/'>Ansible Getting Started</a> > Writing Your First Playbook
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#what-are-collections-and-why-should-i-care">What are Collections and why should I care?</a></li>
    <li><a href="#playbook-basics">Playbook Basics</a></li>
    <li><a href="#creating-a-directory-structure-and-file-for-your-playbook">Creating a Directory Structure and File for your Playbook</a></li>
    <li><a href="#running-the-playbook">Running the Playbook</a></li>
    <li><a href="#extend-your-playbook-start--enable-apache">Extend your Playbook: Start &amp; Enable Apache</a></li>
    <li><a href="#extend-your-playbook-create-an-indexhtml">Extend your Playbook: Create an index.html</a></li>
    <li><a href="#practice-apply-to-multiple-host">Practice: Apply to Multiple Host</a></li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Writing Your First Playbook
            </h1>
          

        



	<p>While Ansible ad hoc commands are useful for simple operations, they are not suited for complex configuration management or orchestration scenarios. For such use cases <strong>Playbooks</strong> are the way to go.</p>
<p>Playbooks are files which describe the desired configurations or steps to implement on managed hosts. Playbooks can change lengthy, complex administrative tasks into easily repeatable routines with predictable and successful outcomes.</p>
<p>A Playbook is where you can take some of those ad hoc commands you just ran and put them into a repeatable set of <strong>Plays</strong> and <strong>Tasks</strong>.</p>
<p>A Playbook can have multiple Plays and a Play can have one or multiple Tasks. In a Task a <strong>Module</strong> is called, like the Modules in the previous chapter.</p>
<ul>
<li>The goal of a Play is to map a group of hosts to a list of Tasks.</li>
<li>The goal of a Task is to implement Modules against those hosts.</li>
</ul>

<div class="notices tip" ><p>Here is a nice analogy: When Ansible Modules are the tools in your workshop, the Inventory is the list of materials and the Playbooks are the instructions.</p>
</div>

<h2 id="what-are-collections-and-why-should-i-care">What are Collections and why should I care?</h2>
<p>Ansible Collections are a new distribution format for Ansible content that can include playbooks, roles, modules, and plugins. Ansible Collection names are a combination of two components. The first part is the name of the author who wrote and maintains the Ansible Collection. The second part is the name of the Ansible Collection. This allows one author to have multiple Collections. It also allows multiple authors to have Ansible Collections with the same name.</p>
<pre><code>&lt;author&gt;.&lt;collection&gt;
</code></pre>
<p>These are examples for Ansible Collection names:</p>
<ul>
<li>
<p>ansible.posix</p>
</li>
<li>
<p>geerlingguy.k8s</p>
</li>
<li>
<p>theforeman.foreman</p>
</li>
</ul>
<p>To identify a specific module in an Ansible Collection, we add the name of it as the third part:</p>
<pre><code>&lt;author&gt;.&lt;collection&gt;.&lt;module&gt;
</code></pre>
<p>Valid examples for a fully qualified Ansible Collection Name (FQCN):</p>
<ul>
<li>
<p>ansible.posix.selinux</p>
</li>
<li>
<p>geerlingguy.k8s.kubernetes</p>
</li>
<li>
<p>geerlingguy.php_roles.mysql</p>
</li>
<li>
<p>theforeman.foreman.user</p>
</li>
</ul>

<div class="notices info" ><p>Many modules and plugins are part of the &ldquo;ansible.builtin&rdquo; collection and are shipped with Ansible and installed automatically. Although not mandatory, it is highly recommended to also use the FQCN for builtin modules, to avoid name clashes or unpredictable behavior. This is why all following examples, will use &ldquo;ansible.builtin&rdquo; as part of the FQCN.</p>
</div>


<div class="notices tip" ><p>If you want to learn more about Ansible Collection, feel free to have a look at our <a href="../../ansible-collections/">Ansible Collections Workshop</a></p>
</div>

<h2 id="playbook-basics">Playbook Basics</h2>
<p>Playbooks are text files written in YAML format and therefore need:</p>
<ul>
<li>
<p>to start with three dashes (<code>---</code>)</p>
</li>
<li>
<p>proper indentation using spaces and <strong>not</strong> tabs!</p>
</li>
</ul>
<p>There are some important concepts:</p>
<ul>
<li>
<p><strong>hosts</strong>: the managed hosts to perform the tasks on</p>
</li>
<li>
<p><strong>tasks</strong>: the operations to be performed by invoking Ansible modules and passing them the necessary options.</p>
</li>
<li>
<p><strong>become</strong>: privilege escalation in Playbooks, same as using <code>-b</code> in the ad hoc command.</p>
</li>
</ul>

<div class="notices tip" ><p>The ordering of the contents within a Playbook is important, because Ansible executes plays and tasks in the order they are presented.</p>
</div>

<p>A Playbook should be <strong>idempotent</strong>, so if a Playbook is run once to put the hosts in the correct state, it should be safe to run it a second time and it should make no further changes to the hosts.</p>

<div class="notices tip" ><p>Most Ansible modules are idempotent, so it is relatively easy to ensure this is true.</p>
</div>

<h2 id="creating-a-directory-structure-and-file-for-your-playbook">Creating a Directory Structure and File for your Playbook</h2>
<p>Enough theory, it’s time to create your first Playbook. In this lab you create a Playbook to set up an Apache webserver in three steps:</p>
<ul>
<li>
<p>First step: Install httpd package</p>
</li>
<li>
<p>Second step: Enable/start httpd service</p>
</li>
<li>
<p>Third step: Create an index.html file</p>
</li>
</ul>
<p>This Playbook makes sure the package containing the Apache webserver is installed on <code>node1</code>.</p>
<p>There is a <a href="http://docs.ansible.com/ansible/playbooks_best_practices.html">best practice</a> on the preferred directory structures for playbooks.  We strongly encourage you to read and understand these practices as you develop your Ansible ninja skills.  That said, our playbook today is very basic and creating a complex structure will just confuse things.</p>
<p>Instead, we are going to create a very simple directory structure for our playbook, and add just a couple of files to it.</p>
<p>In your browser, bring up your <strong>VS Code</strong> terminal (you opened one in the first section) and create a directory called <code>ansible-files</code> in your home directory and change into it:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>ec2-user@autoctl1 ~<span style="color:#f92672">]</span>$ mkdir ansible-files
<span style="color:#f92672">[</span>ec2-user@autoctl1 ~<span style="color:#f92672">]</span>$ cd ansible-files/
</code></pre></div><p>Now use <strong>VS Code</strong> to add a file called <code>apache.yml</code> with the following content.</p>

<div class="notices tip" ><p>If you are unsure how to use <strong>VS Code</strong> (basically like VSCode), have a quick look at the <a href="../../vscode-intro/">Visual Studio Code Server introduction</a></p>
</div>

<pre><code>---
- name: Apache server installed
  hosts: node1
  become: yes
</code></pre><p>This shows one of Ansible’s strengths: The Playbook syntax is easy to read and understand. In this Playbook:</p>
<ul>
<li>
<p>A name is given for the play via <code>name:</code>.</p>
</li>
<li>
<p>The host to run the playbook against is defined via <code>hosts:</code>.</p>
</li>
<li>
<p>We enable user privilege escalation with <code>become:</code>.</p>
</li>
</ul>

<div class="notices tip" ><p>You obviously need to use privilege escalation to install a package or run any other task that requires root permissions. This is done in the Playbook by <code>become: yes</code>.</p>
</div>

<p>Now that we&rsquo;ve defined the play, let&rsquo;s add a task to get something done. We will add a task in which yum will ensure that the Apache package is installed in the latest version. Modify the file so that it looks like the following listing using the <strong>VS Code</strong> editor:</p>
<pre><code>---
- name: Apache server installed
  hosts: node1
  become: yes
  tasks:
  - name: latest Apache version installed
    ansible.builtin.yum:
      name: httpd
      state: latest
</code></pre>
<div class="notices tip" ><p>Since playbooks are written in YAML, alignment of the lines and keywords is crucial. Make sure to vertically align the <em>t</em> in <code>task</code> with the <em>b</em> in <code>become</code>. Once you are more familiar with Ansible, make sure to take some time and study a bit the <a href="http://docs.ansible.com/ansible/YAMLSyntax.html">YAML Syntax</a>.</p>
</div>

<p>In the added lines:</p>
<ul>
<li>
<p>We started the tasks part with the keyword <code>tasks:</code>.</p>
</li>
<li>
<p>A task is named and the module for the task is referenced. Here it uses the <code>yum</code> module.</p>
</li>
<li>
<p>Parameters for the module are added:</p>
<ul>
<li>
<p><code>name:</code> to identify the package name</p>
</li>
<li>
<p><code>state:</code> to define the wanted state of the package</p>
</li>
</ul>
</li>
</ul>

<div class="notices tip" ><p>The module parameters are individual to each module. If in doubt, look them up again with <code>ansible-doc</code>.</p>
</div>

<p>Save your playbook.</p>
<h2 id="running-the-playbook">Running the Playbook</h2>
<p>Playbooks are executed using the <code>ansible-playbook</code> command on the control node. Before you run a new Playbook it’s a good idea to check for syntax errors. Head over to the <strong>VS Code</strong> terminal and run:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>ec2-user@autoctl1 ansible-files<span style="color:#f92672">]</span>$ ansible-playbook --syntax-check apache.yml
</code></pre></div><p>Now you should be ready to run your Playbook:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>ec2-user@autoctl1 ansible-files<span style="color:#f92672">]</span>$ ansible-playbook apache.yml
</code></pre></div><p>The output should not report any errors but provide an overview of the tasks executed and a <strong>Play Recap</strong> summarizing what has been done. There is also a task called <strong>Gathering Facts</strong> listed: this is a built-in task that runs automatically at the beginning of each <strong>Play</strong>. It collects information about the managed nodes. Exercises later on will cover this in more detail.</p>
<p>Use SSH to make sure Apache has been installed on <code>node1</code>. The necessary IP address is provided in the inventory. Grep for the IP address there and use it to SSH to the node.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>ec2-user@autoctl1 ansible-files<span style="color:#f92672">]</span>$ grep node1 ~/lab_inventory/hosts
node1 ansible_host<span style="color:#f92672">=</span>11.22.33.44
<span style="color:#f92672">[</span>ec2-user@autoctl1 ansible-files<span style="color:#f92672">]</span>$ ssh 11.22.33.44
Last login: Wed May <span style="color:#ae81ff">15</span> 14:03:45 <span style="color:#ae81ff">2019</span> from 44.55.66.77
Managed by Ansible
<span style="color:#f92672">[</span>...<span style="color:#f92672">]</span>
<span style="color:#f92672">[</span>ec2-user@node1 ~<span style="color:#f92672">]</span>$ rpm -qi httpd
Name        : httpd
Version     : 2.4.6
<span style="color:#f92672">[</span>...<span style="color:#f92672">]</span>
</code></pre></div><p>Log out of <code>node1</code> with the command <code>exit</code> so that you are back on the control host, and verify the installed package with an Ansible ad hoc command!</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>ec2-user@autoctl1 ansible-files<span style="color:#f92672">]</span>$ ansible node1 -m command -a <span style="color:#e6db74">&#39;rpm -qi httpd&#39;</span>
</code></pre></div><p>Run the Playbook a second time, and compare the output: The output changed from <strong>changed</strong> to <strong>ok</strong>, and the color changed from yellow to green. Also the <strong>PLAY RECAP</strong> output is different now. This make it easy to spot what Ansible actually did.</p>
<h2 id="extend-your-playbook-start--enable-apache">Extend your Playbook: Start &amp; Enable Apache</h2>
<p>The next part of the Playbook makes sure the Apache webserver is enabled and started on <code>node1</code>.</p>
<p>On the control host, as your student user, edit the file <code>~/ansible-files/apache.yml</code> again to add a second task using the <code>service</code> module. The Playbook should now look like this:</p>
<pre><code>---
- name: Apache server installed
  hosts: node1
  become: yes
  tasks:
  - name: latest Apache version installed
    ansible.builtin.yum:
      name: httpd
      state: latest
  - name: Apache enabled and running
    ansible.builtin.service:
      name: httpd
      enabled: true
      state: started
</code></pre><p>Again: what these lines do is easy to understand:</p>
<ul>
<li>
<p>a second task is created and named</p>
</li>
<li>
<p>a module is specified (<code>service</code>)</p>
</li>
<li>
<p>parameters for the module are supplied</p>
</li>
</ul>
<p>With the second task we make sure the Apache server is indeed running on the target machine. Run your extended Playbook:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>ec2-user@autoctl1 ansible-files<span style="color:#f92672">]</span>$ ansible-playbook apache.yml
</code></pre></div><p>Note the output now: Some tasks are shown as <strong>ok</strong> in green and one is shown as <strong>changed</strong> in yellow.</p>
<ul>
<li>
<p>Use an Ansible ad hoc command again to make sure Apache has been enabled and started, e.g. with: <code>systemctl status httpd</code>.</p>
</li>
<li>
<p>Run the Playbook a second time to get used to the change in the output.</p>
</li>
</ul>
<h2 id="extend-your-playbook-create-an-indexhtml">Extend your Playbook: Create an index.html</h2>
<p>Check that the tasks were executed correctly and Apache is accepting connections: Make an HTTP request using Ansible’s <code>uri</code> module in an ad hoc command from the control node. Make sure to replace the <strong>IP</strong> with the IP for the node from the inventory.</p>

<div class="notices warning" ><p>Expect a lot of red lines and a 403 status</p>
</div>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>ec2-user@autoctl1 ansible-files<span style="color:#f92672">]</span>$ ansible localhost -m uri -a <span style="color:#e6db74">&#34;url=http://&lt;IP&gt;&#34;</span>
</code></pre></div><p>There are a lot of red lines and an error: As long as there is not at least an <code>index.html</code> file to be served by Apache, it will throw an ugly <strong>HTTP Error 403: Forbidden</strong> status and Ansible will report an error.</p>
<p>So why not use Ansible to deploy a simple <code>index.html</code> file? Create the file <code>~/ansible-files/index.html</code> on the control node:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">body</span>&gt;
&lt;<span style="color:#f92672">h1</span>&gt;Apache is running fine&lt;/<span style="color:#f92672">h1</span>&gt;
&lt;/<span style="color:#f92672">body</span>&gt;
</code></pre></div><p>You already used Ansible’s <code>copy</code> module to write text supplied on the command line into a file. Now you’ll use the module in your Playbook to actually copy a file:</p>
<p>On the control node as your student user edit the file <code>~/ansible-files/apache.yml</code> and add a new task utilizing the <code>copy</code> module. It should now look like this:</p>
<pre><code>---
- name: Apache server installed
  hosts: node1
  become: yes
  tasks:
  - name: latest Apache version installed
    ansible.builtin.yum:
      name: httpd
      state: latest
  - name: Apache enabled and running
    ansible.builtin.service:
      name: httpd
      enabled: true
      state: started
  - name: copy index.html
    ansible.builtin.copy:
      src: ~/ansible-files/index.html
      dest: /var/www/html/
</code></pre><p>You are getting used to the Playbook syntax, so what happens? The new task uses the <code>copy</code> module and defines the source and destination options for the copy operation as parameters.</p>
<p>Run your extended Playbook:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>ec2-user@autoctl1 ansible-files<span style="color:#f92672">]</span>$ ansible-playbook apache.yml
</code></pre></div><ul>
<li>
<p>Have a good look at the output</p>
</li>
<li>
<p>Run the ad hoc command  using the &ldquo;uri&rdquo; module from further above again to test Apache: The command should now return a friendly green &ldquo;status: 200&rdquo; line, amongst other information.</p>
</li>
</ul>
<h2 id="practice-apply-to-multiple-host">Practice: Apply to Multiple Host</h2>
<p>This was nice but the real power of Ansible is to apply the same set of tasks reliably to many hosts.</p>
<ul>
<li>So what about changing the apache.yml Playbook to run on <code>node1</code> <strong>and</strong> <code>node2</code> <strong>and</strong> <code>node3</code>?</li>
</ul>
<p>As you might remember, the inventory lists all nodes as members of the group <code>web</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ini" data-lang="ini"><span style="color:#66d9ef">[web]</span>
<span style="color:#a6e22e">node1 ansible_host</span><span style="color:#f92672">=</span><span style="color:#e6db74">11.22.33.44</span>
<span style="color:#a6e22e">node2 ansible_host</span><span style="color:#f92672">=</span><span style="color:#e6db74">22.33.44.55</span>
<span style="color:#a6e22e">node3 ansible_host</span><span style="color:#f92672">=</span><span style="color:#e6db74">33.44.55.66</span>
</code></pre></div>
<div class="notices tip" ><p>The IP addresses shown here are just examples, your nodes will have different IP addresses.</p>
</div>

<p>Change the Playbook to point to the group <code>web</code>:</p>
<pre><code>---
- name: Apache server installed
  hosts: web
  become: yes
  tasks:
  - name: latest Apache version installed
    ansible.builtin.yum:
      name: httpd
      state: latest
  - name: Apache enabled and running
    ansible.builtin.service:
      name: httpd
      enabled: true
      state: started
  - name: copy index.html
    ansible.builtin.copy:
      src: ~/ansible-files/index.html
      dest: /var/www/html/
</code></pre><p>Now run the Playbook:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>ec2-user@autoctl1 ansible-files<span style="color:#f92672">]</span>$ ansible-playbook apache.yml
</code></pre></div><p>Finally check if Apache is now running on all servers. Identify the IP addresses of the nodes in your inventory first, and afterwards use them each in the ad hoc command with the uri module as we already did with the <code>node1</code> above. All output should be green.</p>





<footer class=" footline" >
	
</footer>

        
        </div>
        

      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        

        


	 
	 
		
			<a class="nav nav-prev" href="https://ansible-labs-crew.github.io/ansible-getting-started/2-adhoc/" title="Running ad hoc commands"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="https://ansible-labs-crew.github.io/ansible-getting-started/4-variables/" title="Using Variables" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="https://ansible-labs-crew.github.io/js/clipboard.min.js?1632505063"></script>
    <script src="https://ansible-labs-crew.github.io/js/perfect-scrollbar.min.js?1632505063"></script>
    <script src="https://ansible-labs-crew.github.io/js/perfect-scrollbar.jquery.min.js?1632505063"></script>
    <script src="https://ansible-labs-crew.github.io/js/jquery.sticky.js?1632505063"></script>
    <script src="https://ansible-labs-crew.github.io/js/featherlight.min.js?1632505063"></script>
    <script src="https://ansible-labs-crew.github.io/js/highlight.pack.js?1632505063"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="https://ansible-labs-crew.github.io/js/modernizr.custom-3.6.0.js?1632505063"></script>
    <script src="https://ansible-labs-crew.github.io/js/learn.js?1632505063"></script>
    <script src="https://ansible-labs-crew.github.io/js/hugo-learn.js?1632505063"></script>
    
        
            <script src="https://ansible-labs-crew.github.io/mermaid/mermaid.js?1632505063"></script>
        
        <script>
            mermaid.initialize({ startOnLoad: true });
        </script>
    
    

  </body>
</html>
