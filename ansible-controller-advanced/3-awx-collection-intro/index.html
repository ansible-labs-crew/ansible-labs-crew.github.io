<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.69.0" />
    <meta name="description" content="Ansible and Ansible Automation Platform Labs">
<meta name="author" content="Christian, Eric, Götz">

    <link rel="icon" href="https://ansible-labs-crew.github.io/images/favicon.png" type="image/png">

    <title>There is more to automation controller than the Web UI :: Ansible Labs for Red Hat Summit 2021</title>

    
    <link href="https://ansible-labs-crew.github.io/css/nucleus.css?1632305474" rel="stylesheet">
    <link href="https://ansible-labs-crew.github.io/css/fontawesome-all.min.css?1632305474" rel="stylesheet">
    <link href="https://ansible-labs-crew.github.io/css/hybrid.css?1632305474" rel="stylesheet">
    <link href="https://ansible-labs-crew.github.io/css/featherlight.min.css?1632305474" rel="stylesheet">
    <link href="https://ansible-labs-crew.github.io/css/perfect-scrollbar.min.css?1632305474" rel="stylesheet">
    <link href="https://ansible-labs-crew.github.io/css/auto-complete.css?1632305474" rel="stylesheet">
    <link href="https://ansible-labs-crew.github.io/css/atom-one-dark-reasonable.css?1632305474" rel="stylesheet">
    <link href="https://ansible-labs-crew.github.io/css/theme.css?1632305474" rel="stylesheet">
    <link href="https://ansible-labs-crew.github.io/css/tabs.css?1632305474" rel="stylesheet">
    <link href="https://ansible-labs-crew.github.io/css/hugo-theme.css?1632305474" rel="stylesheet">
    
    <link href="https://ansible-labs-crew.github.io/css/theme-red.css?1632305474" rel="stylesheet">
    
    

    <script src="https://ansible-labs-crew.github.io/js/jquery-3.3.1.min.js?1632305474"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
        :not(pre) > code + span.copy-to-clipboard {
            display: none;
        }
      
    </style>
    
  </head>
  <body class="" data-url="/ansible-controller-advanced/3-awx-collection-intro/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="https://ansible-labs-crew.github.io/">
  <img src="https://ansible-labs-crew.github.io/images/summit-2021.png">
</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="https://ansible-labs-crew.github.io/js/lunr.min.js?1632305474"></script>
<script type="text/javascript" src="https://ansible-labs-crew.github.io/js/auto-complete.js?1632305474"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/ansible-labs-crew.github.io\/";
    
</script>
<script type="text/javascript" src="https://ansible-labs-crew.github.io/js/search.js?1632305474"></script>

    
  </div>
  
    <section id="homelinks">
      <ul>
        <li>
            <a class="padding" href='https://ansible-labs-crew.github.io/'><i class='fas fa-home'></i> Home</a>
        </li>
      </ul>
    </section>
  

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/ansible-getting-started/" title="Ansible Getting Started" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-getting-started/">
          Ansible Getting Started
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/ansible-getting-started/1-setup/" title="Check the Prerequisites" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-getting-started/1-setup/">
          Check the Prerequisites
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-getting-started/2-adhoc/" title="Running ad hoc commands" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-getting-started/2-adhoc/">
          Running ad hoc commands
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-getting-started/3-playbook/" title="Writing Your First Playbook" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-getting-started/3-playbook/">
          Writing Your First Playbook
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-getting-started/4-variables/" title="Using Variables" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-getting-started/4-variables/">
          Using Variables
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-getting-started/5-handlers/" title="Conditionals, Handlers and Loops" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-getting-started/5-handlers/">
          Conditionals, Handlers and Loops
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-getting-started/6-templates/" title="Templates" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-getting-started/6-templates/">
          Templates
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-getting-started/7-bonus/" title="Bonus Labs" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-getting-started/7-bonus/">
          Bonus Labs
          
      </a>
      
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ansible-controller-getting-started/" title="Ansible automation controller getting started" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-getting-started/">
          Ansible automation controller getting started
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-getting-started/1-intro/" title="Introduction to automation controller" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-getting-started/1-intro/">
          Introduction to automation controller
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-getting-started/2-cred/" title="Inventories, credentials and ad hoc commands" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-getting-started/2-cred/">
          Inventories, credentials and ad hoc commands
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-getting-started/3-projects/" title="Projects &amp; job templates" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-getting-started/3-projects/">
          Projects &amp; job templates
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-getting-started/4-surveys/" title="Surveys" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-getting-started/4-surveys/">
          Surveys
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-getting-started/5-rbac/" title="Role-based access control" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-getting-started/5-rbac/">
          Role-based access control
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-getting-started/6-workflows/" title="Workflows" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-getting-started/6-workflows/">
          Workflows
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-getting-started/7-wrap/" title="Wrap up" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-getting-started/7-wrap/">
          Wrap up
          
      </a>
      
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ansible-controller-advanced/" title="Ansible automation controller advanced" class="dd-item
        parent
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-advanced/">
          Ansible automation controller advanced
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-advanced/1-intro/" title="Introduction to your lab" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-advanced/1-intro/">
          Introduction to your lab
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-advanced/2-clustering/" title="Introduction to automation controller clustering" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-advanced/2-clustering/">
          Introduction to automation controller clustering
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-advanced/3-awx-collection-intro/" title="There is more to automation controller than the Web UI" class="dd-item
        
        active
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-advanced/3-awx-collection-intro/">
          There is more to automation controller than the Web UI
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-advanced/4-tower-cluster-jobs/" title="Run a Job in a Cluster" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-advanced/4-tower-cluster-jobs/">
          Run a Job in a Cluster
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-advanced/5-instance-groups/" title="automation controller instance groups" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-advanced/5-instance-groups/">
          automation controller instance groups
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-advanced/6-parallel-jobs/" title="Parallel Jobs" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-advanced/6-parallel-jobs/">
          Parallel Jobs
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-advanced/7-advanced-inventories/" title="Advanced Inventories" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-advanced/7-advanced-inventories/">
          Advanced Inventories
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-advanced/8-structured-content/" title="Well Structured Content Repositories" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-advanced/8-structured-content/">
          Well Structured Content Repositories
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-advanced/9-rest-api/" title="Discovering the automation controller API" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-advanced/9-rest-api/">
          Discovering the automation controller API
          
      </a>
      
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ansible-collections/" title="Ansible Collections" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-collections/">
          Ansible Collections
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/ansible-collections/1-introduction/" title="Introduction" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-collections/1-introduction/">
          Introduction
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-collections/2-using-collections-from-playbooks/" title="Collections from Playbook" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-collections/2-using-collections-from-playbooks/">
          Collections from Playbook
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-collections/3-using-collections-from-roles/" title="Collections from Roles" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-collections/3-using-collections-from-roles/">
          Collections from Roles
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-collections/4-using-collections-from-tower/" title="Collections in automation controller" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-collections/4-using-collections-from-tower/">
          Collections in automation controller
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-collections/5-creating-collections/" title="Creating Collections" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-collections/5-creating-collections/">
          Creating Collections
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-collections/6-automation-hub-and-galaxy/" title="Use Automation Hub" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-collections/6-automation-hub-and-galaxy/">
          Use Automation Hub
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/ansible-collections/6-automation-hub-and-galaxy/screenshots/" title="" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-collections/6-automation-hub-and-galaxy/screenshots/">
          
          
      </a>
      
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vscode-intro/" title="Visual Studio Code - Introduction" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/vscode-intro/">
          Visual Studio Code - Introduction
          
      </a>
      
      
    </li>
  
 

          
        
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li>
                  <a class="padding" href="https://goetzrieger.github.io/"><i class='fas fa-home'></i> Homepage</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="footer">
      <p></p>
    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='https://ansible-labs-crew.github.io/'></a> > <a href='https://ansible-labs-crew.github.io/ansible-controller-advanced/'>Ansible automation controller advanced</a> > There is more to automation controller than the Web UI
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#authentication">Authentication</a></li>
    <li><a href="#create-an-inventory">Create an inventory</a></li>
    <li><a href="#add-hosts-to-inventory">Add hosts to inventory</a></li>
    <li><a href="#create-machine-credentials">Create Machine Credentials</a></li>
    <li><a href="#create-projects">Create Projects</a></li>
    <li><a href="#create-a-template">Create a Template</a></li>
    <li><a href="#verify-the-cluster">Verify the cluster</a></li>
    <li><a href="#challenge-labs">Challenge Labs</a></li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              There is more to automation controller than the Web UI
            </h1>
          

        



	<p>This is an advanced automation controller lab so we don’t really want you to use the web UI for everything. To fully embrace automation and adopt the <a href="https://en.wikipedia.org/wiki/Infrastructure_as_code">infrastructure as code</a> methodology, we want to use Ansible to configure our automation controller cluster.</p>
<p>Since automation controller is exposing all of its functionality via REST API, we can automate everything. Instead of using the API directly, it is highly recommended to use the <a href="https://github.com/ansible/awx/tree/devel/awx_collection">AWX</a> or <a href="https://cloud.redhat.com/ansible/automation-hub/repo/published/ansible/controller">automation controller</a> Ansible Collection (the second link will only work for you, if you have an active Red Hat Ansible Automation Platform Subscription) to setup, configure and maintain your Red Hat Ansible Automation Platform Cluster.</p>

<div class="notices info" ><p>For the purpose of this lab, we will use the community AWX collection. Red Hat Customers will prefer the supported Ansible automation controller collection. Since this requires an active subscription and we want to make the lab usable for everyone, we will stick with the AWX collection for the purpose of the lab.</p>
</div>

<p>First, we need to install the AWX Collection on the <code>bastion</code> node. Installing Ansible Collections is straight forward:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>lab-user@bastion ~<span style="color:#f92672">]</span>$ ansible-galaxy collection install awx.awx:19.2.2
</code></pre></div>
<div class="notices note" ><p>The AWX collection is updated very often. To make sure the following lab instructions will work for you, we install specifically version 19.2.2. We regularly update these instruction to keep up to date and don&rsquo;t fall behind too much. However, to make sure the lab works for you, we suggest you to use the specified version.</p>
</div>

<h2 id="authentication">Authentication</h2>
<p>Before we can do any changes on our automation controller, we have to authenticate our user. There are several methods available to provide authentication details to the modules. In this lab, we&rsquo;ll use environment variables. In your VSCode UI use either your prefered editor from the commandline or the visual editor (open a new file by going to <strong>File-&gt;New File</strong>) to open a new file and add the following:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># the Base URI of our automation controller cluster node</span>
export CONTROLLER_HOST<span style="color:#f92672">=</span>https://autoctl1.&lt;GUID&gt;.&lt;SANDBOXID&gt;.opentlc.com
<span style="color:#75715e"># the user name</span>
export CONTROLLER_USERNAME<span style="color:#f92672">=</span>admin
<span style="color:#75715e"># and the password</span>
export CONTROLLER_PASSWORD<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;VERY_SECRET_PASSWORD&#39;</span>
<span style="color:#75715e"># do not verify the SSL certificate, in production, you will use proper SSL certificates and not need this option or set it to True</span>
export CONTROLLER_VERIFY_SSL<span style="color:#f92672">=</span>false
</code></pre></div>
<div class="notices warning" ><p>As always make sure to replace <code>&lt;GUID&gt;</code> and <code>&lt;SANDBOXID&gt;</code>!</p>
</div>

<p>Save the file in the home directoy of <code>lab-user</code> as <code>set-connection.sh</code>, when using the visual editor in VSCode do <strong>File-&gt;Save as</strong>.</p>
<p>Now set the environment variables by sourcing the file:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>lab-user@bastion ~<span style="color:#f92672">]</span>$ source set-connection.sh
</code></pre></div>
<div class="notices warning" ><p>Make sure you define the environment variables in the same shell you want to later run your Ansible Playbook from, otherwise the Playbook will fail due to authentication errors. If you lost connection to VSCode, just source the <code>set-connection.sh</code> file again.</p>
</div>

<h2 id="create-an-inventory">Create an inventory</h2>
<p>Now we&rsquo;ll start to create a Playbook with the tasks needed to configure our automation controller. Let&rsquo;s start with creating an inventory and then extend the Playbook step by step.</p>
<p>In your VSCode UI use either your prefered editor from the commandline or the visual editor again to open a new file and add the following:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">---
- <span style="color:#66d9ef">name</span>: Configure automation controller
  <span style="color:#66d9ef">hosts</span>: localhost
  <span style="color:#66d9ef">become</span>: <span style="color:#66d9ef">false</span>
  <span style="color:#66d9ef">gather_facts</span>: <span style="color:#66d9ef">false</span>
  <span style="color:#66d9ef">tasks</span>:
  - <span style="color:#66d9ef">name</span>: Create an inventory
    <span style="color:#66d9ef">awx.awx.inventory</span>:
      <span style="color:#66d9ef">name</span>: AWX inventory
      <span style="color:#66d9ef">organization</span>: Default
</code></pre></div><p>Since we are calling the REST API of automation controller, the Ansible Playbook is run against <strong>localhost</strong>, but the module will connect to the URL provided by the <strong>CONTROLLER_HOST</strong> environment variable you set above.</p>
<p>Save the file in the home directoy of <code>lab-user</code> as <code>configure-controller.yml</code>.</p>
<p>Run your playbook:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>lab-user@bastion ~<span style="color:#f92672">]</span>$ ansible-playbook configure-controller.yml
</code></pre></div><p>Now verify everything worked as expected by logging into the automation controller Web UI and checking the inventory <code>AWX Inventory</code> has been created</p>

<div class="notices info" ><p>You might see a warning message &ldquo;You are using the awx version of this collection but connecting to Red Hat Ansible Automation Platform&rdquo;. This can be ignored. As said above, we intentionally use the AWX Community Collection for the purpose of the lab. As a Red Hat Customer you would probably prefer the supported Ansible Collection instead.</p>
</div>

<h2 id="add-hosts-to-inventory">Add hosts to inventory</h2>
<p>Now that we have the empty inventory created, extend the Playbook to add your three managed hosts using their internal hostnames <strong><code>node1.&lt;GUID&gt;.internal</code></strong> and <strong><code>node2.&lt;GUID&gt;.internal</code></strong> and <strong><code>node3.&lt;GUID&gt;.internal</code></strong>, again using the AWX Ansible Collection. The module to add hosts to an inventory is called <strong>awx.awx.host</strong>.</p>
<ul>
<li>Read the documentation and try to figure out how to add the necessary tasks to the Ansible Playbook or use the solution below.</li>
<li>Add the task to the Playbook in your favorite editor.</li>
</ul>

<div class="notices info" ><p>Use <strong>ansible-doc awx.awx.host</strong> to open the documentation for the specified module.</p>
</div>

<details><summary><b>Click here for Solution</b></summary>
<hr/>
<p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">---
- <span style="color:#66d9ef">name</span>: Configure automation controller
  <span style="color:#66d9ef">hosts</span>: localhost
  <span style="color:#66d9ef">become</span>: <span style="color:#66d9ef">false</span>
  <span style="color:#66d9ef">gather_facts</span>: <span style="color:#66d9ef">false</span>
  <span style="color:#66d9ef">tasks</span>:
  - <span style="color:#66d9ef">name</span>: Create an inventory
    <span style="color:#66d9ef">awx.awx.inventory</span>:
      <span style="color:#66d9ef">name</span>: AWX inventory
      <span style="color:#66d9ef">organization</span>: Default
  - <span style="color:#66d9ef">name</span>: Add hosts to inventory
    <span style="color:#66d9ef">awx.awx.host</span>:
      <span style="color:#66d9ef">name</span>: <span style="color:#e6db74">&#34;{{  item }}&#34;</span>
      <span style="color:#66d9ef">inventory</span>: AWX inventory
      <span style="color:#66d9ef">state</span>: present
    <span style="color:#66d9ef">loop</span>:
      - node1.&lt;GUID&gt;.internal
      - node2.&lt;GUID&gt;.internal
      - node3.&lt;GUID&gt;.internal
</code></pre></div></p>
<hr/>
</details>
<p>Run your playbook again and verify everything worked as expected, by logging into the automation controller Web UI and verifying the hosts have been created in the inventory <code>AWX Inventory</code>.</p>
<h2 id="create-machine-credentials">Create Machine Credentials</h2>
<p>From here onwards we&rsquo;ll extend the Playbook, it&rsquo;s up to you if you add all sections to the Playbook first and then run it or if you do it step by step.</p>

<div class="notices tip" ><p>SSH keys have already been created and distributed in your lab environment and <code>sudo</code> has been setup on the managed hosts to allow password-less login. When you SSH into a host as user <code>lab-user</code> from <strong>bastion.&lt;GUID&gt;.internal</strong> you will become user <strong>ec2-user</strong> on the host you logged in.</p>
</div>

<p>The next step is to configure credentials to access our managed hosts. The private key for <code>lab-user</code> is stored in <code>/home/lab-user/.ssh/&lt;GUID&gt;key.pem</code> and already configured on the managed nodes. Try to find the necessary attributes in the <strong>awx.awx.credential</strong> module documentation or use the solution provided and add this to the Playbook.</p>

<div class="notices warning" ><p>And again do not forget to <strong>replace &lt;GUID&gt;</strong>! We&rsquo;ll stop mentioning this at some point, though&hellip; :-)</p>
</div>

<details><summary><b>Click here for Solution</b></summary>
<hr/>
<p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">---
- <span style="color:#66d9ef">name</span>: Configure automation controller
  <span style="color:#66d9ef">hosts</span>: localhost
  <span style="color:#66d9ef">become</span>: <span style="color:#66d9ef">false</span>
  <span style="color:#66d9ef">gather_facts</span>: <span style="color:#66d9ef">false</span>
  <span style="color:#66d9ef">tasks</span>:
  - <span style="color:#66d9ef">name</span>: Create an inventory
    <span style="color:#66d9ef">awx.awx.inventory</span>:
      <span style="color:#66d9ef">name</span>: AWX inventory
      <span style="color:#66d9ef">organization</span>: Default
  - <span style="color:#66d9ef">name</span>: Add hosts to inventory
    <span style="color:#66d9ef">awx.awx.host</span>:
      <span style="color:#66d9ef">name</span>: <span style="color:#e6db74">&#34;{{  item }}&#34;</span>
      <span style="color:#66d9ef">inventory</span>: AWX inventory
      <span style="color:#66d9ef">state</span>: present
    <span style="color:#66d9ef">loop</span>:
      - node1.&lt;GUID&gt;.internal
      - node2.&lt;GUID&gt;.internal
  - <span style="color:#66d9ef">name</span>: Machine Credentials
    <span style="color:#66d9ef">awx.awx.credential</span>:
      <span style="color:#66d9ef">name</span>: AWX Credentials
      <span style="color:#66d9ef">kind</span>: ssh
      <span style="color:#66d9ef">organization</span>: Default
      <span style="color:#66d9ef">inputs</span>:
        <span style="color:#66d9ef">username</span>: ec2-user
        <span style="color:#66d9ef">ssh_key_data</span>: <span style="color:#e6db74">&#34;{{ lookup(&#39;file&#39;, &#39;~/.ssh/&lt;GUID&gt;key.pem&#39; ) }}&#34;</span>
</code></pre></div></p>
<hr/>
</details>

<div class="notices info" ><p>If you run this Ansible Playbook multiple times, you will notice the <strong>awx.awx.credential</strong> module is not idempotent! Since we store the SSH key encrypted, the Ansible Module is unable to verify it has already been set and didn&rsquo;t change. This is what we want and expect from a secure system, but it also means Ansible has no means to verify it and hence overrides the SSH key or password every time the Ansible Playbook is executed.</p>
</div>

<p>Run and test your playbook and verify everything works as expected, by logging into the automation controller Web UI.</p>
<h2 id="create-projects">Create Projects</h2>
<p>The Ansible content used in this lab is hosted on Github in the project <a href="https://github.com/goetzrieger/ansible-labs-playbooks.git">https://github.com/goetzrieger/ansible-labs-playbooks.git</a>. The next step is to add a project to import the Ansible Playbooks. As before, try to figure out the necessary parameters by reading the documentation of the <strong>awx.awx.project</strong> module documentation.</p>
<details><summary><b>Click here for Solution</b></summary>
<hr/>
<p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">---
- <span style="color:#66d9ef">name</span>: Configure automation controller
  <span style="color:#66d9ef">hosts</span>: localhost
  <span style="color:#66d9ef">become</span>: <span style="color:#66d9ef">false</span>
  <span style="color:#66d9ef">gather_facts</span>: <span style="color:#66d9ef">false</span>
  <span style="color:#66d9ef">tasks</span>:
  - <span style="color:#66d9ef">name</span>: Create an inventory
    <span style="color:#66d9ef">awx.awx.inventory</span>:
      <span style="color:#66d9ef">name</span>: AWX inventory
      <span style="color:#66d9ef">organization</span>: Default
  - <span style="color:#66d9ef">name</span>: Add hosts to inventory
    <span style="color:#66d9ef">awx.awx.host</span>:
      <span style="color:#66d9ef">name</span>: <span style="color:#e6db74">&#34;{{  item }}&#34;</span>
      <span style="color:#66d9ef">inventory</span>: AWX inventory
      <span style="color:#66d9ef">state</span>: present
    <span style="color:#66d9ef">loop</span>:
      - node1.&lt;GUID&gt;.internal
      - node2.&lt;GUID&gt;.internal
  - <span style="color:#66d9ef">name</span>: Machine Credentials
    <span style="color:#66d9ef">awx.awx.credential</span>:
      <span style="color:#66d9ef">name</span>: AWX Credentials
      <span style="color:#66d9ef">kind</span>: ssh
      <span style="color:#66d9ef">organization</span>: Default
      <span style="color:#66d9ef">inputs</span>:
        <span style="color:#66d9ef">username</span>: ec2-user
        <span style="color:#66d9ef">ssh_key_data</span>: <span style="color:#e6db74">&#34;{{ lookup(&#39;file&#39;, &#39;~/.ssh/aws-private.pem&#39; ) }}&#34;</span>
  - <span style="color:#66d9ef">name</span>: AWX Project
    <span style="color:#66d9ef">awx.awx.project</span>:
      <span style="color:#66d9ef">name</span>: AWX Project
      <span style="color:#66d9ef">organization</span>: Default
      <span style="color:#66d9ef">state</span>: present
      <span style="color:#66d9ef">scm_update_on_launch</span>: True
      <span style="color:#66d9ef">scm_delete_on_update</span>: True
      <span style="color:#66d9ef">scm_type</span>: git
      <span style="color:#66d9ef">scm_url</span>: https://github.com/goetzrieger/ansible-labs-playbooks.git
</code></pre></div></p>
<hr/>
</details>
<p>Run and test your playbook and verify everything works as expected, by logging into the automation controller Web UI.</p>
<p>If you wonder why <strong>awx.awx.credential</strong> is not idempotent, read the info box in the <a href="#create-machine-credentials">previous chapter</a>.</p>
<h2 id="create-a-template">Create a Template</h2>
<p>Before running an Ansible <strong>Job</strong> from your automation controller cluster you must create a <strong>Template</strong>, again business as usual for automation controller users. For this part of the Ansible Playbook, we will use the <strong>awx.awx.job_template</strong> module. The name of the Ansible Playbook you want run is <code>apache_install.yml</code>.</p>
<details><summary><b>Click here for Solution</b></summary>
<hr/>
<p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">---
- <span style="color:#66d9ef">name</span>: Configure automation controller
  <span style="color:#66d9ef">hosts</span>: localhost
  <span style="color:#66d9ef">become</span>: <span style="color:#66d9ef">false</span>
  <span style="color:#66d9ef">gather_facts</span>: <span style="color:#66d9ef">false</span>
  <span style="color:#66d9ef">tasks</span>:
  - <span style="color:#66d9ef">name</span>: Create an inventory
    <span style="color:#66d9ef">awx.awx.inventory</span>:
      <span style="color:#66d9ef">name</span>: AWX inventory
      <span style="color:#66d9ef">organization</span>: Default
  - <span style="color:#66d9ef">name</span>: Add hosts to inventory
    <span style="color:#66d9ef">awx.awx.host</span>:
      <span style="color:#66d9ef">name</span>: <span style="color:#e6db74">&#34;{{  item }}&#34;</span>
      <span style="color:#66d9ef">inventory</span>: AWX inventory
      <span style="color:#66d9ef">state</span>: present
    <span style="color:#66d9ef">loop</span>:
      - node1.&lt;GUID&gt;.internal
      - node2.&lt;GUID&gt;.internal
  - <span style="color:#66d9ef">name</span>: Machine Credentials
    <span style="color:#66d9ef">awx.awx.credential</span>:
      <span style="color:#66d9ef">name</span>: AWX Credentials
      <span style="color:#66d9ef">kind</span>: ssh
      <span style="color:#66d9ef">organization</span>: Default
      <span style="color:#66d9ef">inputs</span>:
        <span style="color:#66d9ef">username</span>: ec2-user
        <span style="color:#66d9ef">ssh_key_data</span>: <span style="color:#e6db74">&#34;{{ lookup(&#39;file&#39;, &#39;~/.ssh/aws-private.pem&#39; ) }}&#34;</span>
  - <span style="color:#66d9ef">name</span>: AWX Project
    <span style="color:#66d9ef">awx.awx.project</span>:
      <span style="color:#66d9ef">name</span>: AWX Project
      <span style="color:#66d9ef">organization</span>: Default
      <span style="color:#66d9ef">state</span>: present
      <span style="color:#66d9ef">scm_update_on_launch</span>: True
      <span style="color:#66d9ef">scm_delete_on_update</span>: True
      <span style="color:#66d9ef">scm_type</span>: git
      <span style="color:#66d9ef">scm_url</span>: https://github.com/goetzrieger/ansible-labs-playbooks.git
  - <span style="color:#66d9ef">name</span>: AWX Job Template
    <span style="color:#66d9ef">awx.awx.job_template</span>:
      <span style="color:#66d9ef">name</span>: Install Apache
      <span style="color:#66d9ef">organization</span>: Default
      <span style="color:#66d9ef">state</span>: present
      <span style="color:#66d9ef">inventory</span>: AWX inventory
      <span style="color:#66d9ef">become_enabled</span>: True
      <span style="color:#66d9ef">playbook</span>: apache_install.yml
      <span style="color:#66d9ef">project</span>: AWX Project
      <span style="color:#66d9ef">credential</span>: AWX Credentials

</code></pre></div></p>
<hr/>
</details>
<p>Run and test your playbook and verify everything works as expected, by logging into the automation controller Web UI.</p>
<h2 id="verify-the-cluster">Verify the cluster</h2>
<p>We are working in a clustered environment. To verify that the resources were created on all instances properly, login to the other controller nodes web UI&rsquo;s.</p>
<p>Have a look around, everything we automatically configured on one controller instance with our Ansible Playbook was <strong>synchronized automatically</strong> to the other nodes. Inventory, credentials, projects, templates, all there.</p>
<h2 id="challenge-labs">Challenge Labs</h2>
<p>Add a task to the Ansible Playbook you wrote in this chapter to automatically run the job <strong>Template</strong> you created. If you don&rsquo;t know how to start, check out the documentation of the <strong>awx.awx.job_launch</strong> module by running <code>ansible-doc</code> in your VSCode terminal:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>lab-user@bastion ~<span style="color:#f92672">]</span>$ ansible-doc awx.awx.tower_job_launch
</code></pre></div><details><summary><b>Click here for Solution</b></summary>
<hr/>
<p>
<p>This is a Challenge Lab! No solution here.</p>
</p>
<hr/>
</details>





<footer class=" footline" >
	
</footer>

        
        </div>
        

      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        

        


	 
	 
		
			<a class="nav nav-prev" href="https://ansible-labs-crew.github.io/ansible-controller-advanced/2-clustering/" title="Introduction to automation controller clustering"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="https://ansible-labs-crew.github.io/ansible-controller-advanced/4-tower-cluster-jobs/" title="Run a Job in a Cluster" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="https://ansible-labs-crew.github.io/js/clipboard.min.js?1632305474"></script>
    <script src="https://ansible-labs-crew.github.io/js/perfect-scrollbar.min.js?1632305474"></script>
    <script src="https://ansible-labs-crew.github.io/js/perfect-scrollbar.jquery.min.js?1632305474"></script>
    <script src="https://ansible-labs-crew.github.io/js/jquery.sticky.js?1632305474"></script>
    <script src="https://ansible-labs-crew.github.io/js/featherlight.min.js?1632305474"></script>
    <script src="https://ansible-labs-crew.github.io/js/highlight.pack.js?1632305474"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="https://ansible-labs-crew.github.io/js/modernizr.custom-3.6.0.js?1632305474"></script>
    <script src="https://ansible-labs-crew.github.io/js/learn.js?1632305474"></script>
    <script src="https://ansible-labs-crew.github.io/js/hugo-learn.js?1632305474"></script>
    
        
            <script src="https://ansible-labs-crew.github.io/mermaid/mermaid.js?1632305474"></script>
        
        <script>
            mermaid.initialize({ startOnLoad: true });
        </script>
    
    

  </body>
</html>
