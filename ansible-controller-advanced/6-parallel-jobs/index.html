<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.69.0" />
    <meta name="description" content="Ansible and Ansible Automation Platform Labs">
<meta name="author" content="Christian, Eric, GÃ¶tz">

    <link rel="icon" href="https://ansible-labs-crew.github.io/images/favicon.png" type="image/png">

    <title>Parallel Jobs :: Ansible Labs for Red Hat Summit 2021</title>

    
    <link href="https://ansible-labs-crew.github.io/css/nucleus.css?1636387952" rel="stylesheet">
    <link href="https://ansible-labs-crew.github.io/css/fontawesome-all.min.css?1636387952" rel="stylesheet">
    <link href="https://ansible-labs-crew.github.io/css/hybrid.css?1636387952" rel="stylesheet">
    <link href="https://ansible-labs-crew.github.io/css/featherlight.min.css?1636387952" rel="stylesheet">
    <link href="https://ansible-labs-crew.github.io/css/perfect-scrollbar.min.css?1636387952" rel="stylesheet">
    <link href="https://ansible-labs-crew.github.io/css/auto-complete.css?1636387952" rel="stylesheet">
    <link href="https://ansible-labs-crew.github.io/css/atom-one-dark-reasonable.css?1636387952" rel="stylesheet">
    <link href="https://ansible-labs-crew.github.io/css/theme.css?1636387952" rel="stylesheet">
    <link href="https://ansible-labs-crew.github.io/css/tabs.css?1636387952" rel="stylesheet">
    <link href="https://ansible-labs-crew.github.io/css/hugo-theme.css?1636387952" rel="stylesheet">
    
    <link href="https://ansible-labs-crew.github.io/css/theme-red.css?1636387952" rel="stylesheet">
    
    

    <script src="https://ansible-labs-crew.github.io/js/jquery-3.3.1.min.js?1636387952"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
        :not(pre) > code + span.copy-to-clipboard {
            display: none;
        }
      
    </style>
    
  </head>
  <body class="" data-url="/ansible-controller-advanced/6-parallel-jobs/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="https://ansible-labs-crew.github.io/">
  <img src="https://ansible-labs-crew.github.io/images/summit-2021.png">
</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="https://ansible-labs-crew.github.io/js/lunr.min.js?1636387952"></script>
<script type="text/javascript" src="https://ansible-labs-crew.github.io/js/auto-complete.js?1636387952"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/ansible-labs-crew.github.io\/";
    
</script>
<script type="text/javascript" src="https://ansible-labs-crew.github.io/js/search.js?1636387952"></script>

    
  </div>
  
    <section id="homelinks">
      <ul>
        <li>
            <a class="padding" href='https://ansible-labs-crew.github.io/'><i class='fas fa-home'></i> Home</a>
        </li>
      </ul>
    </section>
  

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/ansible-getting-started/" title="Ansible Getting Started" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-getting-started/">
          Ansible Getting Started
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/ansible-getting-started/1-setup/" title="Check the Prerequisites" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-getting-started/1-setup/">
          Check the Prerequisites
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-getting-started/2-adhoc/" title="Running ad hoc commands" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-getting-started/2-adhoc/">
          Running ad hoc commands
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-getting-started/3-playbook/" title="Writing Your First Playbook" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-getting-started/3-playbook/">
          Writing Your First Playbook
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-getting-started/4-variables/" title="Using Variables" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-getting-started/4-variables/">
          Using Variables
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-getting-started/5-handlers/" title="Conditionals, Handlers and Loops" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-getting-started/5-handlers/">
          Conditionals, Handlers and Loops
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-getting-started/6-templates/" title="Templates" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-getting-started/6-templates/">
          Templates
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-getting-started/7-bonus/" title="Bonus Labs" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-getting-started/7-bonus/">
          Bonus Labs
          
      </a>
      
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ansible-controller-getting-started/" title="Ansible automation controller getting started" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-getting-started/">
          Ansible automation controller getting started
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-getting-started/1-intro/" title="Introduction to automation controller" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-getting-started/1-intro/">
          Introduction to automation controller
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-getting-started/2-cred/" title="Inventories, credentials and ad hoc commands" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-getting-started/2-cred/">
          Inventories, credentials and ad hoc commands
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-getting-started/3-projects/" title="Projects &amp; job templates" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-getting-started/3-projects/">
          Projects &amp; job templates
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-getting-started/4-surveys/" title="Surveys" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-getting-started/4-surveys/">
          Surveys
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-getting-started/5-rbac/" title="Role-based access control" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-getting-started/5-rbac/">
          Role-based access control
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-getting-started/6-workflows/" title="Workflows" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-getting-started/6-workflows/">
          Workflows
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-getting-started/7-wrap/" title="Wrap up" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-getting-started/7-wrap/">
          Wrap up
          
      </a>
      
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ansible-controller-advanced/" title="Ansible automation controller advanced" class="dd-item
        parent
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-advanced/">
          Ansible automation controller advanced
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-advanced/1-intro/" title="Introduction to your lab" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-advanced/1-intro/">
          Introduction to your lab
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-advanced/2-clustering/" title="Introduction to automation controller clustering" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-advanced/2-clustering/">
          Introduction to automation controller clustering
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-advanced/3-awx-collection-intro/" title="There is more to automation controller than the Web UI" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-advanced/3-awx-collection-intro/">
          There is more to automation controller than the Web UI
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-advanced/4-cluster-jobs/" title="Primer on Execution Environments: Running Jobs in a Cluster" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-advanced/4-cluster-jobs/">
          Primer on Execution Environments: Running Jobs in a Cluster
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-advanced/5-instance-groups/" title="automation controller instance groups" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-advanced/5-instance-groups/">
          automation controller instance groups
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-advanced/6-parallel-jobs/" title="Parallel Jobs" class="dd-item
        
        active
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-advanced/6-parallel-jobs/">
          Parallel Jobs
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-advanced/7-advanced-inventories/" title="Advanced Inventories" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-advanced/7-advanced-inventories/">
          Advanced Inventories
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-advanced/8-structured-content/" title="Well Structured Content Repositories" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-advanced/8-structured-content/">
          Well Structured Content Repositories
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-advanced/9-rest-api/" title="Discovering the automation controller API" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-advanced/9-rest-api/">
          Discovering the automation controller API
          
      </a>
      
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ansible-collections/" title="Ansible Collections" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-collections/">
          Ansible Collections
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/ansible-collections/1-introduction/" title="Introduction" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-collections/1-introduction/">
          Introduction
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-collections/2-using-collections-from-playbooks/" title="Collections from Playbook" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-collections/2-using-collections-from-playbooks/">
          Collections from Playbook
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-collections/3-using-collections-from-roles/" title="Collections from Roles" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-collections/3-using-collections-from-roles/">
          Collections from Roles
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-collections/4-using-collections-from-tower/" title="Collections in automation controller" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-collections/4-using-collections-from-tower/">
          Collections in automation controller
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-collections/5-creating-collections/" title="Creating Collections" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-collections/5-creating-collections/">
          Creating Collections
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-collections/6-automation-hub-and-galaxy/" title="Use Automation Hub" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-collections/6-automation-hub-and-galaxy/">
          Use Automation Hub
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/ansible-collections/6-automation-hub-and-galaxy/screenshots/" title="" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-collections/6-automation-hub-and-galaxy/screenshots/">
          
          
      </a>
      
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vscode-intro/" title="Visual Studio Code - Introduction" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/vscode-intro/">
          Visual Studio Code - Introduction
          
      </a>
      
      
    </li>
  
 

          
        
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li>
                  <a class="padding" href="https://goetzrieger.github.io/"><i class='fas fa-home'></i> Homepage</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="footer">
      <p></p>
    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='https://ansible-labs-crew.github.io/'></a> > <a href='https://ansible-labs-crew.github.io/ansible-controller-advanced/'>Ansible automation controller advanced</a> > Parallel Jobs
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#lab-scenario">Lab Scenario</a></li>
    <li><a href="#prepare-the-compliance-lab">Prepare the Compliance Lab</a>
      <ul>
        <li><a href="#create-three-templates">Create three Templates</a></li>
      </ul>
    </li>
    <li><a href="#create-parallel-workflow">Create Parallel Workflow</a></li>
    <li><a href="#execute-and-watch">Execute and Watch</a></li>
    <li><a href="#deactivate-a-node">Deactivate a node</a></li>
    <li><a href="#using-instance-groups">Using Instance Groups</a>
      <ul>
        <li><a href="#assign-jobs-to-instance-groups">Assign Jobs to Instance Groups</a></li>
        <li><a href="#run-the-workflow">Run the Workflow</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Parallel Jobs
            </h1>
          

        



	<p>The real power of instance groups is revealed when multiple jobs are started, and they are assigned to different controller nodes. To launch parallel jobs we will set up a workflow with multiple concurrent jobs.</p>
<h2 id="lab-scenario">Lab Scenario</h2>
<p>To configure something meaningful we&rsquo;ll make a quick detour into security automation here. During this lab weâll focus on security compliance according to STIG, CIS and so on. Often these compliance rules are enforced by executing an Ansible task per each requirement. This makes documentation and audit easier.</p>
<p>Compliance requirements are often grouped into independent categories. The tasks can often be executed in parallel because they do not conflict with each other.</p>
<p>In our demo case we use three playbooks which:</p>
<ul>
<li>
<p>ensure the absence of a few packages (STIG)</p>
</li>
<li>
<p>ensure configuration of PAM and login cryptography (STIG)</p>
</li>
<li>
<p>ensure absence of services and kernel modules (CIS).</p>
</li>
</ul>
<p>The Playbooks can be found in the Github repository you already setup as a <strong>Project</strong> in your controller.</p>
<h2 id="prepare-the-compliance-lab">Prepare the Compliance Lab</h2>
<h3 id="create-three-templates">Create three Templates</h3>
<p>As mentioned the Github repository you configured as a <strong>Project</strong> contains three Playbooks to enforce different compliance requirements. Since you learned in the previous chapter how to configure automation controller with the AWX Collection from a Playbook, we want to put that knowledge to the test. Create a new Playbook in your VScode editor on the bastion node that creates the needed job <strong>Templates</strong> for the provided Ansible Playbooks in automation controller. Create one task for each of the three Ansible Playbooks:</p>
<ul>
<li>
<p><strong>stig-packages.yml</strong> (task name <code>Compliance STIG packages</code>)</p>
</li>
<li>
<p><strong>stig-config.yml</strong> (task name <code>Compliance STIG config</code>)</p>
</li>
<li>
<p><strong>cis.yml</strong> (task name <code>Compliance CIS</code>)</p>
</li>
</ul>
<p>You can basically use the task definition <code>AWX Job Template</code> from the Playbook <code>configure-controller.yml</code> and adapt the task&rsquo;s name and playbook parameters. With one important addition:</p>
<ul>
<li>Change the Execution Environment by adding <code>execution_environment: Ansible Engine 2.9 execution environment</code> to each task. This is needed because the default Execution Environment doesn&rsquo;t contain a module we use in the Playbooks (<code>modprobe</code>)</li>
</ul>

<div class="notices tip" ><p>If you closed your VSCode terminal or lost connection, the environment variables with the connection parameters are gone. Just set them again by sourcing the <code>set-connection.sh</code> file you created before.</p>
</div>

<details><summary><b>Click here for Solution</b></summary>
<hr/>
<p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">---
- <span style="color:#66d9ef">name</span>: Configure automation controller
  <span style="color:#66d9ef">hosts</span>: localhost
  <span style="color:#66d9ef">become</span>: <span style="color:#66d9ef">false</span>
  <span style="color:#66d9ef">gather_facts</span>: <span style="color:#66d9ef">false</span>
  <span style="color:#66d9ef">tasks</span>:

  - <span style="color:#66d9ef">name</span>: Compliance STIG packages Job Template
    <span style="color:#66d9ef">awx.awx.job_template</span>:
      <span style="color:#66d9ef">name</span>: Compliance STIG packages
      <span style="color:#66d9ef">organization</span>: Default
      <span style="color:#66d9ef">state</span>: present
      <span style="color:#66d9ef">inventory</span>: AWX inventory
      <span style="color:#66d9ef">become_enabled</span>: True
      <span style="color:#66d9ef">playbook</span>: stig-packages.yml
      <span style="color:#66d9ef">project</span>: AWX Project
      <span style="color:#66d9ef">credential</span>: AWX Credentials
      <span style="color:#66d9ef">execution_environment</span>: Ansible Engine <span style="color:#ae81ff">2.9</span> execution environment

  - <span style="color:#66d9ef">name</span>: Compliance STIG config Job Template
    <span style="color:#66d9ef">awx.awx.job_template</span>:
      <span style="color:#66d9ef">name</span>: Compliance STIG config
      <span style="color:#66d9ef">organization</span>: Default
      <span style="color:#66d9ef">state</span>: present
      <span style="color:#66d9ef">inventory</span>: AWX inventory
      <span style="color:#66d9ef">become_enabled</span>: True
      <span style="color:#66d9ef">playbook</span>: stig-config.yml
      <span style="color:#66d9ef">project</span>: AWX Project
      <span style="color:#66d9ef">credential</span>: AWX Credentials
      <span style="color:#66d9ef">execution_environment</span>: Ansible Engine <span style="color:#ae81ff">2.9</span> execution environment

  - <span style="color:#66d9ef">name</span>: Compliance CIS Job Template
    <span style="color:#66d9ef">awx.awx.job_template</span>:
      <span style="color:#66d9ef">name</span>: Compliance CIS
      <span style="color:#66d9ef">organization</span>: Default
      <span style="color:#66d9ef">state</span>: present
      <span style="color:#66d9ef">inventory</span>: AWX inventory
      <span style="color:#66d9ef">become_enabled</span>: True
      <span style="color:#66d9ef">playbook</span>: cis.yml
      <span style="color:#66d9ef">project</span>: AWX Project
      <span style="color:#66d9ef">credential</span>: AWX Credentials
      <span style="color:#66d9ef">execution_environment</span>: Ansible Engine <span style="color:#ae81ff">2.9</span> execution environment
</code></pre></div></p>
<hr/>
</details>
<h2 id="create-parallel-workflow">Create Parallel Workflow</h2>
<p>To enable parallel execution of the tasks in these job templates, we will create a workflow using the web UI. Workflows are configured in the <strong>Templates</strong> view, you might have noticed you can choose between <strong>Add job template</strong> and <strong>Add workflow template</strong> when adding a template.</p>
<ul>
<li>
<p>Go to the <strong>Templates</strong> view and click the <img src="../../images/blue_add_dd.png?classes=inline" alt="Add"> button. Choose <strong>Add workflow template</strong></p>
<ul>
<li>
<p><strong>Name:</strong> Compliance Workflow</p>
</li>
<li>
<p><strong>Organization:</strong> Default - click on the magnifying glass if necessary</p>
</li>
<li>
<p>Click <strong>Save</strong></p>
</li>
</ul>
</li>
<li>
<p>Now the <strong>Workflow Visualizer</strong> graphical workflow designer opens.</p>
</li>
<li>
<p>Click on the <strong>Start</strong> button, a dialog to configure a new workflow node opens.</p>
</li>
<li>
<p>First select the node type, you can choose between <strong>Job Template, Project Sync, Inventory Source Sync, Approval</strong> and <strong>Workflow Job Template</strong>.</p>
</li>
<li>
<p>Select <strong>Job Template</strong></p>
</li>
<li>
<p>In this lab weâll link multiple jobs to the <strong>Start</strong>, so select the <strong>Compliance STIG packages</strong> job template your Playbook configured and click <strong>Save</strong>. The new workflow node gets annotated with the name of the job.</p>
</li>
<li>
<p>Hover your mouse over the now blue <strong>Start</strong> button and click the <strong>+</strong> sign, the <strong>Add Node</strong> dialog opens again.</p>
</li>
<li>
<p>This time select the <strong>Compliance STIG config</strong> job template and hit <strong>Save</strong>.</p>
</li>
<li>
<p>Hover your mouse over the <strong>Start</strong> button again, and configure the last job template.</p>
</li>
<li>
<p>Select the <strong>Compliance CIS</strong> job template and click <strong>Save</strong>.</p>
</li>
<li>
<p>Click the blue <strong>Save</strong> button at the upper right to save the workflow.</p>
</li>
<li>
<p>Your workflow is now ready, you can always open the workflow visualizer again by clicking the <strong>Visualizer</strong> tab of the workflow.</p>
</li>
</ul>
<p>You have configured a Workflow that is not going through templates one after the other but rather executes three templates in parallel.</p>
<p><img src="../../images/compliance-workflow.png" alt="compliance workflow"></p>
<h2 id="execute-and-watch">Execute and Watch</h2>
<p>Your workflow is ready to go, launch it.</p>
<ul>
<li>
<p>In the <strong>Templates</strong> view launch the <strong>Compliance Workflow</strong> by clicking the rocket icon.</p>
</li>
<li>
<p>Wait until the workflow has finished.</p>
</li>
</ul>
<p>Go to the <strong>Instance Groups</strong> view and find out how the jobs where distributed over the instances:</p>
<ul>
<li>
<p>Open the <strong>controlplane</strong> instance group by clicking it and switch to the <strong>Instances</strong> tab.</p>
</li>
<li>
<p>Look at the <strong>Total Jobs</strong> view of the three instances</p>
</li>
<li>
<p>Because the Job Templates called in the workflow didnât specify an instance group, they where distributed (more or less) evenly over the instances.</p>
</li>
</ul>
<h2 id="deactivate-a-node">Deactivate a node</h2>
<p>Now deactivate instance <strong>autoctl1.&lt;GUID&gt;.internal</strong> by setting the slider button to <strong>Off</strong> and wait until it is shown as unavailable. Make a (mental) note of the <strong>Total Jobs</strong> counter of the instance. Go back to the list of templates and launch the workflow <strong>Compliance Workflow</strong> again.</p>
<p>Go back to the <strong>Instance Groups</strong> view, get back to the instance overview of instance group <strong>controlplane</strong> and verify that the three Playbooks where launched on the remaining instances and the <strong>Total Jobs</strong> counter of instance <strong>autoctl1.&lt;GUID&gt;.internal</strong> didnât change.</p>
<p>Activate <strong>autoctl1.&lt;GUID&gt;.internal</strong> by sliding the button to <strong>On</strong> again.</p>
<h2 id="using-instance-groups">Using Instance Groups</h2>
<p>So we have seen how a automation controller cluster is distributing jobs over instances by default. We have already created instance groups which allow us to take control over which job is executed on which node, so letâs use them.</p>
<p>To make it easier to spot where the jobs were run, letâs first empty the jobs history. This can be done using the <strong>awx-manage</strong> utility on one of the automation controller instances. From your VSCode terminal as <code>lab-user</code> SSH to your <code>autoctl1.&lt;GUID&gt;.internal</code> node, become user <code>awx</code> and run the actual command:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>lab-user@bastion ~<span style="color:#f92672">]</span>$ ssh autoctl1.&lt;GUID&gt;.internal
<span style="color:#f92672">[</span>ec2-user@autoctl1 ~<span style="color:#f92672">]</span>$ sudo -u awx -i
<span style="color:#f92672">[</span>awx@autoctl1 ~<span style="color:#f92672">]</span>$ awx-manage cleanup_jobs  --days<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</code></pre></div><p>Then exit back to being <code>lab-user</code> on the bastion node again. If you now check the <strong>Total Jobs</strong> of your instances they should show count &ldquo;0&rdquo;.</p>
<h3 id="assign-jobs-to-instance-groups">Assign Jobs to Instance Groups</h3>
<p>One way to assign a job to an instance group is in the job template. As our compliance workflow uses three job templates, do this for all of them:</p>
<ul>
<li>
<p>In the web UI, go to <strong>Templates</strong></p>
</li>
<li>
<p>Open one of the three (Compliance CIS, Compliance STIG config, Compliance STIG packages) compliance templates (<strong>not</strong> the workflow template)</p>
</li>
<li>
<p>Click <strong>Edit</strong></p>
</li>
<li>
<p>In the <strong>Instance Groups</strong> field, choose the <strong>dev</strong> instance group and click <strong>Select</strong>.</p>
</li>
<li>
<p>Click <strong>Save</strong> for the job template!</p>
</li>
<li>
<p>Do this for the other two compliance templates, too.</p>
</li>
</ul>
<p>Now the jobs that make up our <strong>Compliance Workflow</strong> are all configured to run on the instances of the <strong>dev</strong> instance group.</p>
<h3 id="run-the-workflow">Run the Workflow</h3>
<p>You have done this a couple of times now, you should get along without detailed instructions.</p>
<ul>
<li>
<p>Run the <strong>Compliance Workflow</strong></p>
</li>
<li>
<p>What would you expect? On what instance(s) should the workflow jobs run?</p>
</li>
<li>
<p>Verify!</p>
</li>
</ul>

<div class="notices tip" ><p><strong>Result:</strong> The workflow and the associated jobs will run on <strong>autoctl2.&lt;GUID&gt;.internal</strong>. Okay, big surprise, in the <strong>dev</strong> instance group there is only one instance.</p>
</div>

<p>But whatâs going to happen if you disable this instance?</p>
<ul>
<li>
<p>Disable the <strong>autoctl2.&lt;GUID&gt;.internal</strong> instance on the <strong>Instances</strong> tab of <strong>Instance Group</strong> <code>dev</code> by setting the switch to <strong>Off</strong>.</p>
</li>
<li>
<p>Run the workflow again.</p>
</li>
<li>
<p>What would you expect? On what instance(s) should the workflow jobs run?</p>
</li>
<li>
<p>Verify!</p>
</li>
</ul>

<div class="notices tip" ><p><strong>Result:</strong> The workflow is running but the associated jobs will stay in pending state because there are no instances available in the `dev&rsquo; instance group, and the workflow runs &ldquo;forever&rdquo;.</p>
</div>

<p>Whatâs going to happen if you enable the instance again?</p>
<ul>
<li>
<p>Go to the <strong>Instances</strong> tab of the instance group <code>dev</code> again and enable <strong>autoctl2.&lt;GUID&gt;.internal</strong>.</p>
</li>
<li>
<p>Check in the <strong>Jobs</strong> and <strong>Instance Groups</strong> view whatâs happening.</p>
</li>
</ul>

<div class="notices tip" ><p><strong>Result:</strong> After the instance is enabled again the jobs will pickup and run on <strong>autoctl2.&lt;GUID&gt;.internal</strong>.</p>
</div>


<div class="notices warning" ><p>At this point make sure the instances you disabled in the previous steps are definitely enabled again! Otherwise subsequent lab tasks might failâ¦</p>
</div>






<footer class=" footline" >
	
</footer>

        
        </div>
        

      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        

        


	 
	 
		
			<a class="nav nav-prev" href="https://ansible-labs-crew.github.io/ansible-controller-advanced/5-instance-groups/" title="automation controller instance groups"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="https://ansible-labs-crew.github.io/ansible-controller-advanced/7-advanced-inventories/" title="Advanced Inventories" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="https://ansible-labs-crew.github.io/js/clipboard.min.js?1636387952"></script>
    <script src="https://ansible-labs-crew.github.io/js/perfect-scrollbar.min.js?1636387952"></script>
    <script src="https://ansible-labs-crew.github.io/js/perfect-scrollbar.jquery.min.js?1636387952"></script>
    <script src="https://ansible-labs-crew.github.io/js/jquery.sticky.js?1636387952"></script>
    <script src="https://ansible-labs-crew.github.io/js/featherlight.min.js?1636387952"></script>
    <script src="https://ansible-labs-crew.github.io/js/highlight.pack.js?1636387952"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="https://ansible-labs-crew.github.io/js/modernizr.custom-3.6.0.js?1636387952"></script>
    <script src="https://ansible-labs-crew.github.io/js/learn.js?1636387952"></script>
    <script src="https://ansible-labs-crew.github.io/js/hugo-learn.js?1636387952"></script>
    
        
            <script src="https://ansible-labs-crew.github.io/mermaid/mermaid.js?1636387952"></script>
        
        <script>
            mermaid.initialize({ startOnLoad: true });
        </script>
    
    

  </body>
</html>
