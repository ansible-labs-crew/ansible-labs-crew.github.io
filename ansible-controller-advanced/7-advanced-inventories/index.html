<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.69.0" />
    <meta name="description" content="Ansible and Ansible Automation Platform Labs">
<meta name="author" content="Christian, Eric, Götz">

    <link rel="icon" href="https://ansible-labs-crew.github.io/images/favicon.png" type="image/png">

    <title>Advanced Inventories :: Ansible Labs for Red Hat Summit 2021</title>

    
    <link href="https://ansible-labs-crew.github.io/css/nucleus.css?1633010985" rel="stylesheet">
    <link href="https://ansible-labs-crew.github.io/css/fontawesome-all.min.css?1633010985" rel="stylesheet">
    <link href="https://ansible-labs-crew.github.io/css/hybrid.css?1633010985" rel="stylesheet">
    <link href="https://ansible-labs-crew.github.io/css/featherlight.min.css?1633010985" rel="stylesheet">
    <link href="https://ansible-labs-crew.github.io/css/perfect-scrollbar.min.css?1633010985" rel="stylesheet">
    <link href="https://ansible-labs-crew.github.io/css/auto-complete.css?1633010985" rel="stylesheet">
    <link href="https://ansible-labs-crew.github.io/css/atom-one-dark-reasonable.css?1633010985" rel="stylesheet">
    <link href="https://ansible-labs-crew.github.io/css/theme.css?1633010985" rel="stylesheet">
    <link href="https://ansible-labs-crew.github.io/css/tabs.css?1633010985" rel="stylesheet">
    <link href="https://ansible-labs-crew.github.io/css/hugo-theme.css?1633010985" rel="stylesheet">
    
    <link href="https://ansible-labs-crew.github.io/css/theme-red.css?1633010985" rel="stylesheet">
    
    

    <script src="https://ansible-labs-crew.github.io/js/jquery-3.3.1.min.js?1633010985"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
        :not(pre) > code + span.copy-to-clipboard {
            display: none;
        }
      
    </style>
    
  </head>
  <body class="" data-url="/ansible-controller-advanced/7-advanced-inventories/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="https://ansible-labs-crew.github.io/">
  <img src="https://ansible-labs-crew.github.io/images/summit-2021.png">
</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="https://ansible-labs-crew.github.io/js/lunr.min.js?1633010985"></script>
<script type="text/javascript" src="https://ansible-labs-crew.github.io/js/auto-complete.js?1633010985"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/ansible-labs-crew.github.io\/";
    
</script>
<script type="text/javascript" src="https://ansible-labs-crew.github.io/js/search.js?1633010985"></script>

    
  </div>
  
    <section id="homelinks">
      <ul>
        <li>
            <a class="padding" href='https://ansible-labs-crew.github.io/'><i class='fas fa-home'></i> Home</a>
        </li>
      </ul>
    </section>
  

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/ansible-getting-started/" title="Ansible Getting Started" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-getting-started/">
          Ansible Getting Started
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/ansible-getting-started/1-setup/" title="Check the Prerequisites" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-getting-started/1-setup/">
          Check the Prerequisites
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-getting-started/2-adhoc/" title="Running ad hoc commands" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-getting-started/2-adhoc/">
          Running ad hoc commands
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-getting-started/3-playbook/" title="Writing Your First Playbook" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-getting-started/3-playbook/">
          Writing Your First Playbook
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-getting-started/4-variables/" title="Using Variables" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-getting-started/4-variables/">
          Using Variables
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-getting-started/5-handlers/" title="Conditionals, Handlers and Loops" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-getting-started/5-handlers/">
          Conditionals, Handlers and Loops
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-getting-started/6-templates/" title="Templates" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-getting-started/6-templates/">
          Templates
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-getting-started/7-bonus/" title="Bonus Labs" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-getting-started/7-bonus/">
          Bonus Labs
          
      </a>
      
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ansible-controller-getting-started/" title="Ansible automation controller getting started" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-getting-started/">
          Ansible automation controller getting started
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-getting-started/1-intro/" title="Introduction to automation controller" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-getting-started/1-intro/">
          Introduction to automation controller
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-getting-started/2-cred/" title="Inventories, credentials and ad hoc commands" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-getting-started/2-cred/">
          Inventories, credentials and ad hoc commands
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-getting-started/3-projects/" title="Projects &amp; job templates" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-getting-started/3-projects/">
          Projects &amp; job templates
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-getting-started/4-surveys/" title="Surveys" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-getting-started/4-surveys/">
          Surveys
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-getting-started/5-rbac/" title="Role-based access control" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-getting-started/5-rbac/">
          Role-based access control
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-getting-started/6-workflows/" title="Workflows" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-getting-started/6-workflows/">
          Workflows
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-getting-started/7-wrap/" title="Wrap up" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-getting-started/7-wrap/">
          Wrap up
          
      </a>
      
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ansible-controller-advanced/" title="Ansible automation controller advanced" class="dd-item
        parent
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-advanced/">
          Ansible automation controller advanced
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-advanced/1-intro/" title="Introduction to your lab" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-advanced/1-intro/">
          Introduction to your lab
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-advanced/2-clustering/" title="Introduction to automation controller clustering" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-advanced/2-clustering/">
          Introduction to automation controller clustering
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-advanced/3-awx-collection-intro/" title="There is more to automation controller than the Web UI" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-advanced/3-awx-collection-intro/">
          There is more to automation controller than the Web UI
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-advanced/4-cluster-jobs/" title="Primer on Execution Environments: Running Jobs in a Cluster" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-advanced/4-cluster-jobs/">
          Primer on Execution Environments: Running Jobs in a Cluster
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-advanced/5-instance-groups/" title="automation controller instance groups" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-advanced/5-instance-groups/">
          automation controller instance groups
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-advanced/6-parallel-jobs/" title="Parallel Jobs" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-advanced/6-parallel-jobs/">
          Parallel Jobs
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-advanced/7-advanced-inventories/" title="Advanced Inventories" class="dd-item
        
        active
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-advanced/7-advanced-inventories/">
          Advanced Inventories
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-advanced/8-structured-content/" title="Well Structured Content Repositories" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-advanced/8-structured-content/">
          Well Structured Content Repositories
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-advanced/9-rest-api/" title="Discovering the automation controller API" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-advanced/9-rest-api/">
          Discovering the automation controller API
          
      </a>
      
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ansible-collections/" title="Ansible Collections" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-collections/">
          Ansible Collections
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/ansible-collections/1-introduction/" title="Introduction" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-collections/1-introduction/">
          Introduction
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-collections/2-using-collections-from-playbooks/" title="Collections from Playbook" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-collections/2-using-collections-from-playbooks/">
          Collections from Playbook
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-collections/3-using-collections-from-roles/" title="Collections from Roles" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-collections/3-using-collections-from-roles/">
          Collections from Roles
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-collections/4-using-collections-from-tower/" title="Collections in automation controller" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-collections/4-using-collections-from-tower/">
          Collections in automation controller
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-collections/5-creating-collections/" title="Creating Collections" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-collections/5-creating-collections/">
          Creating Collections
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-collections/6-automation-hub-and-galaxy/" title="Use Automation Hub" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-collections/6-automation-hub-and-galaxy/">
          Use Automation Hub
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/ansible-collections/6-automation-hub-and-galaxy/screenshots/" title="" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-collections/6-automation-hub-and-galaxy/screenshots/">
          
          
      </a>
      
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vscode-intro/" title="Visual Studio Code - Introduction" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/vscode-intro/">
          Visual Studio Code - Introduction
          
      </a>
      
      
    </li>
  
 

          
        
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li>
                  <a class="padding" href="https://goetzrieger.github.io/"><i class='fas fa-home'></i> Homepage</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="footer">
      <p></p>
    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='https://ansible-labs-crew.github.io/'></a> > <a href='https://ansible-labs-crew.github.io/ansible-controller-advanced/'>Ansible automation controller advanced</a> > Advanced Inventories
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#dynamic-inventories">Dynamic Inventories</a>
      <ul>
        <li><a href="#the-inventory-source">The Inventory Source</a></li>
        <li><a href="#the-custom-inventory-script">The Custom Inventory Script</a></li>
        <li><a href="#integrate-into-controller">Integrate into controller</a></li>
        <li><a href="#what-is-the-take-away">What is the take-away?</a></li>
      </ul>
    </li>
    <li><a href="#smart-inventories">Smart Inventories</a>
      <ul>
        <li><a href="#a-simple-smart-inventory">A Simple Smart Inventory</a></li>
        <li><a href="#challenge">Challenge</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Advanced Inventories
            </h1>
          

        



	<p>In Ansible and automation controller, as you know, everything starts with an inventory. There are a several methods how inventories can be created, starting from simple static definitions over importing inventory files to dynamic and smart inventories.</p>
<p>In real life it’s very common to deal with external dynamic inventory sources (think cloud, CMDB, containers, &hellip;). In this chapter we’ll introduce you to building dynamic inventories using custom inventory scripts. Another great feature of the automation controller to deal with inventories is the Smart Inventory feature which you’ll do a lab on as well.</p>
<h2 id="dynamic-inventories">Dynamic Inventories</h2>
<p>Quite often just using static inventories will not be enough. You might be dealing with ever-changing cloud environments or you have to get your managed systems from a CMDB or other sources of truth.</p>
<p>Controller includes built-in support for syncing dynamic inventory from cloud sources such as Amazon AWS, Google Compute Engine, among others. Controller also offers the ability to use custom inventory scripts to pull the data from your own inventory source.</p>
<p>In this chapter you’ll get started with dynamic inventories in the automation controller. Aside from the built-in sources you can write inventory scripts in any programming/scripting language that you have installed on the controller machine. To keep it easy we’ll use a most simple custom inventory script using&hellip; Bash! Yes!</p>

<div class="notices tip" ><p>Don’t get this wrong&hellip; we’ve chosen to use Bash to make it as simple as possible to show the concepts behind dynamic and custom inventories. Usually you’d use Python or some other scripting/programming language.</p>
</div>

<h3 id="the-inventory-source">The Inventory Source</h3>
<p>First you need a source. In <strong>real life</strong> this would be your cloud provider, your CMDB or what not. For the sake of this lab we put a simple file into a Github repository.</p>
<p>Use curl to query your &ldquo;external inventory source&rdquo;:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>lab-user@bastion ~<span style="color:#f92672">]</span>$ curl https://raw.githubusercontent.com/ansible-labs-crew/playbooks_adv_summit2021/master/inventory/inventory_list
<span style="color:#f92672">{</span>
    <span style="color:#e6db74">&#34;dyngroup&#34;</span>:<span style="color:#f92672">{</span>
        <span style="color:#e6db74">&#34;hosts&#34;</span>:<span style="color:#f92672">[</span>
            <span style="color:#e6db74">&#34;cloud1.cloud.example.com&#34;</span>,
            <span style="color:#e6db74">&#34;cloud2.cloud.example.com&#34;</span>
        <span style="color:#f92672">]</span>,
        <span style="color:#e6db74">&#34;vars&#34;</span>:<span style="color:#f92672">{</span>
            <span style="color:#e6db74">&#34;var1&#34;</span>: true
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>,
    <span style="color:#e6db74">&#34;_meta&#34;</span>:<span style="color:#f92672">{</span>
        <span style="color:#e6db74">&#34;hostvars&#34;</span>:<span style="color:#f92672">{</span>
            <span style="color:#e6db74">&#34;cloud1.cloud.example.com&#34;</span>:<span style="color:#f92672">{</span>
                <span style="color:#e6db74">&#34;type&#34;</span>:<span style="color:#e6db74">&#34;web&#34;</span>
            <span style="color:#f92672">}</span>,
            <span style="color:#e6db74">&#34;cloud2.cloud.example.com&#34;</span>:<span style="color:#f92672">{</span>
                <span style="color:#e6db74">&#34;type&#34;</span>:<span style="color:#e6db74">&#34;database&#34;</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>Well, this is handy, the output is already presented as JSON, the way Ansible would expect&hellip; ;-)</p>

<div class="notices warning" ><p>Okay, seriously, in real life your script would likely get some information from your source system, format it as JSON and return the data to the automation controller.</p>
</div>

<h3 id="the-custom-inventory-script">The Custom Inventory Script</h3>
<p>An inventory script has to follow some conventions. It must accept the <strong>&ndash;list</strong> and <strong>&ndash;host &lt;hostname&gt;</strong> arguments. When it is called with <strong>&ndash;list</strong>, the script must output a JSON-encoded data containing all groups and hosts to be managed. When called with <strong>&ndash;host &lt;hostname&gt;</strong> it must return an JSON-formatted hash or dictionary of host variables (can be empty).</p>
<p>As looping over all hosts and calling the script with <strong>&ndash;host</strong> can be pretty slow, it is possible to return a top level element called &ldquo;_meta&rdquo; with all of the host variables in one script run. And this is what we’ll do. So this is our custom inventory script:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#!/bin/bash
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> <span style="color:#e6db74">&#34;</span>$1<span style="color:#e6db74">&#34;</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;--list&#34;</span> <span style="color:#f92672">]</span> ; <span style="color:#66d9ef">then</span>
    curl -sS https://raw.githubusercontent.com/ansible-labs-crew/playbooks_adv_summit2021/master/inventory/inventory_list
<span style="color:#66d9ef">elif</span> <span style="color:#f92672">[</span> <span style="color:#e6db74">&#34;</span>$1<span style="color:#e6db74">&#34;</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;--host&#34;</span> <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span>
    echo <span style="color:#e6db74">&#39;{&#34;_meta&#34;: {&#34;hostvars&#34;: {}}}&#39;</span>
<span style="color:#66d9ef">else</span>
    echo <span style="color:#e6db74">&#34;{ }&#34;</span>
<span style="color:#66d9ef">fi</span>
</code></pre></div><p>What it basically does is to return the data collected by curl when called with <strong>&ndash;list</strong> and as the data includes <strong>_meta</strong> information about the host variables Ansible will not call it with <strong>&ndash;host</strong>. The curl command is of course the place where your script would get data by whatever means, format it as proper JSON and return it (<code>-sS</code> makes curl silent, except for error messages).</p>
<p>But before we integrate the custom inventory script into our controller cluster, it’s a good idea to test it on the command line first:</p>
<ul>
<li>Bring up your VSCode browser tab.</li>
<li>In either the visual editor or in the terminal using your favorite command line editor, Create the file <code>dyninv.sh</code> with the content shown above.</li>
<li>Make the script executable:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>lab-user@bastion ~<span style="color:#f92672">]</span>$ chmod +x dyninv.sh
</code></pre></div><ul>
<li>Execute it:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>lab-user@bastion ~<span style="color:#f92672">]</span>$ ./dyninv.sh --list
<span style="color:#f92672">{</span>
    <span style="color:#e6db74">&#34;dyngroup&#34;</span>:<span style="color:#f92672">{</span>
        <span style="color:#e6db74">&#34;hosts&#34;</span>:<span style="color:#f92672">[</span>
            <span style="color:#e6db74">&#34;cloud1.cloud.example.com&#34;</span>,
            <span style="color:#e6db74">&#34;cloud2.cloud.example.com&#34;</span>
        <span style="color:#f92672">]</span>,
        <span style="color:#e6db74">&#34;vars&#34;</span>:<span style="color:#f92672">{</span>
            <span style="color:#e6db74">&#34;var1&#34;</span>: true
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>,
    <span style="color:#e6db74">&#34;_meta&#34;</span>:<span style="color:#f92672">{</span>
        <span style="color:#e6db74">&#34;hostvars&#34;</span>:<span style="color:#f92672">{</span>
            <span style="color:#e6db74">&#34;cloud1.cloud.example.com&#34;</span>:<span style="color:#f92672">{</span>
                <span style="color:#e6db74">&#34;type&#34;</span>:<span style="color:#e6db74">&#34;web&#34;</span>
            <span style="color:#f92672">}</span>,
            <span style="color:#e6db74">&#34;cloud2.cloud.example.com&#34;</span>:<span style="color:#f92672">{</span>
                <span style="color:#e6db74">&#34;type&#34;</span>:<span style="color:#e6db74">&#34;database&#34;</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>The script should output the JSON-formatted output shown above.</p>
<p>As simple as it gets, right? More information can be found on <a href="https://docs.ansible.com/ansible/latest/dev_guide/developing_inventory.html">how to develop dynamic inventories</a>.</p>
<p>So now you have a source of (slightly static) dynamic inventory data (talk about oxymoron…) and a script to fetch and pass it to controller. Now you need to get this into controller.</p>
<h3 id="integrate-into-controller">Integrate into controller</h3>
<p>In Ansible Tower up to version 3.8, you could create inventory scripts directly in the web UI. Since automation controller 4.0 the only way to get inventory scripts into controller is by putting the script into a source control repository.</p>
<p>For this lab the inventory script was already created in the Git repo you have configured as a <strong>Project</strong> earlier, so you can use this as-is.</p>
<p>You can directly proceed to adding the dynamic inventory and pointing it to the inventory script.</p>
<ul>
<li>
<p>In the web UI, open <strong>Resources ⇒ Inventories</strong>.</p>
</li>
<li>
<p>To create a new custom inventory, click the <img src="../../images/blue_add_dd.png?classes=inline" alt="add"> button and click on <strong>Add inventory</strong>.</p>
</li>
<li>
<p>Fill in the needed data:</p>
<ul>
<li><strong>Name:</strong> Cloud Inventory</li>
</ul>
</li>
<li>
<p>Click <strong>Save</strong></p>
</li>
<li>
<p>Change to the <strong>Sources</strong> tab and once more click the blue <img src="../../images/blue_add.png?classes=inline" alt="add"> button.</p>
</li>
<li>
<p>Fill in the needed data:</p>
<ul>
<li>
<p><strong>Name:</strong> Cloud Inventory Script</p>
</li>
<li>
<p><strong>Source:</strong> Sourced from a Project</p>
</li>
<li>
<p><strong>Project:</strong> AWX Project</p>
</li>
<li>
<p><strong>Inventory file:</strong> inventory/inventory-script</p>
</li>
<li>
<p>enable <strong>Update on launch</strong></p>
</li>
</ul>
</li>
<li>
<p>Click on <strong>Save</strong></p>
</li>
<li>
<p>Start the initial sync by clicking on <strong>Sync</strong></p>
</li>
</ul>
<p>Navigate to <strong>Views ⇒ Jobs</strong> to watch the initial sync, the <strong>Type</strong> is <code>Inventory Sync</code>.</p>
<p>After the inventory sync has finished investigate the new hosts which were added by it to your inventory, by navigating to <strong>Resources ⇒ Hosts</strong>. You should find two new hosts: <code>cloud1.cloud.example.com</code> and <code>cloud2.cloud.example.com</code>.</p>
<h3 id="what-is-the-take-away">What is the take-away?</h3>
<p>Using this simple example you have:</p>
<ul>
<li>
<p>Created a script to query an inventory source</p>
</li>
<li>
<p>Integrated the script into controller</p>
</li>
<li>
<p>Populated an inventory using the custom script</p>
</li>
</ul>
<h2 id="smart-inventories">Smart Inventories</h2>
<p>You will most likely have inventories from different sources in your controller installation. Maybe you have a local CMDB, your virtualization management and your public cloud provider to query for managed systems. Imagine you now want to run automation jobs across these inventories on hosts matching certain search criteria.</p>
<p>This is where Smart Inventories come in. A Smart Inventory is a collection of hosts defined by a stored search. Search criteria can be host attributes (like groups) or facts (such as installed software, services, hardware or whatever information Ansible facts are collected). A Smart Inventory can be viewed like a standard inventory and used for job runs.</p>
<p>Automation controller 4.0 introduces a new UI to build these search filters without the need of advanced regular expression kung-fu.</p>
<h3 id="a-simple-smart-inventory">A Simple Smart Inventory</h3>
<p>Let’s start with a simple string example. In your controller web UI, open the <strong>Resources ⇒ Inventories</strong> view. Then click the <img src="../../images/blue_add_dd.png?classes=inline" alt="add"> button and choose to create a new <strong>Smart Inventory</strong>. In the next view:</p>
<ul>
<li>
<p><strong>Name:</strong> Simple Smart Inventory</p>
</li>
<li>
<p>Click the magnifying glass icon next to <strong>Smart host filter</strong></p>
</li>
<li>
<p>A window <strong>Perform a search to define a host filter</strong> opens, here you define the search query</p>
</li>
</ul>
<p>To start with you can just use simple search terms. Try <strong>cloud</strong> or <strong>example.com</strong> as search terms and see what you get after hitting <strong>ENTER</strong>.</p>

<div class="notices tip" ><p>Search terms are automatically saved so make sure to hit <strong>Clear all filters</strong> to clear the saved search when testing expressions.</p>
</div>

<p>Or what about searching by inventory groups? Switch from <strong>Name</strong> to <strong>Group</strong> and enter <code>dyngroup</code> into the search field. After hitting <strong>ENTER</strong> you should only see cloud1 and cloud2. Try to narrow it down further by e.g. adding a second filter for <strong>Name</strong> <code>cloud2</code>.</p>
<p>When your search returns the results you want, hit <strong>Select</strong> for the <strong>Perform a search to define a host filter</strong> window and <strong>Save</strong> for the Smart Inventory. Now your Smart Inventory is usable for executing job templates!</p>

<div class="notices tip" ><p>There are many additional attributes you can create a filter for - including Ansible facts returned from your managed nodes - but that&rsquo;s for another lab&hellip;</p>
</div>

<h3 id="challenge">Challenge</h3>
<p>Change the <strong>Simple Smart Inventory</strong> filter to include only enabled hosts in your smart inventory. Hosts can be temporarily disabled, for example due to some maintenance work. We want to exclude them from our inventory.</p>
<p>To test the filter, go to <strong>Resources ⇒ Hosts</strong> and disable <code>cloud1.cloud.example.com</code> by switching the slider button to the right to <em>Off</em>. Then open <strong>Resources ⇒ Inventories ⇒ Simple Smart Inventory</strong>, go to the <strong>Hosts</strong> tab and check the hosts.</p>
<details><summary><b>Click here for Solution</b></summary>
<hr/>
<p>
This is an advanced lab, no solution here. But check the previous lab and change the filter to <b>Enabled</b> and <b>Yes</b>.
</p>
<hr/>
</details>





<footer class=" footline" >
	
</footer>

        
        </div>
        

      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        

        


	 
	 
		
			<a class="nav nav-prev" href="https://ansible-labs-crew.github.io/ansible-controller-advanced/6-parallel-jobs/" title="Parallel Jobs"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="https://ansible-labs-crew.github.io/ansible-controller-advanced/8-structured-content/" title="Well Structured Content Repositories" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="https://ansible-labs-crew.github.io/js/clipboard.min.js?1633010985"></script>
    <script src="https://ansible-labs-crew.github.io/js/perfect-scrollbar.min.js?1633010985"></script>
    <script src="https://ansible-labs-crew.github.io/js/perfect-scrollbar.jquery.min.js?1633010985"></script>
    <script src="https://ansible-labs-crew.github.io/js/jquery.sticky.js?1633010985"></script>
    <script src="https://ansible-labs-crew.github.io/js/featherlight.min.js?1633010985"></script>
    <script src="https://ansible-labs-crew.github.io/js/highlight.pack.js?1633010985"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="https://ansible-labs-crew.github.io/js/modernizr.custom-3.6.0.js?1633010985"></script>
    <script src="https://ansible-labs-crew.github.io/js/learn.js?1633010985"></script>
    <script src="https://ansible-labs-crew.github.io/js/hugo-learn.js?1633010985"></script>
    
        
            <script src="https://ansible-labs-crew.github.io/mermaid/mermaid.js?1633010985"></script>
        
        <script>
            mermaid.initialize({ startOnLoad: true });
        </script>
    
    

  </body>
</html>
