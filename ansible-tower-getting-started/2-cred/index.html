<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.69.0" />
    <meta name="description" content="Ansible and Ansible Tower Labs">
<meta name="author" content="Christian, Eric, Götz">

    <link rel="icon" href="https://goetzrieger.github.io/images/favicon.png" type="image/png">

    <title>Inventories, credentials and ad hoc commands :: Ansible Labs for Red Hat Summit 2021</title>

    
    <link href="https://goetzrieger.github.io/css/nucleus.css?1625070012" rel="stylesheet">
    <link href="https://goetzrieger.github.io/css/fontawesome-all.min.css?1625070012" rel="stylesheet">
    <link href="https://goetzrieger.github.io/css/hybrid.css?1625070012" rel="stylesheet">
    <link href="https://goetzrieger.github.io/css/featherlight.min.css?1625070012" rel="stylesheet">
    <link href="https://goetzrieger.github.io/css/perfect-scrollbar.min.css?1625070012" rel="stylesheet">
    <link href="https://goetzrieger.github.io/css/auto-complete.css?1625070012" rel="stylesheet">
    <link href="https://goetzrieger.github.io/css/atom-one-dark-reasonable.css?1625070012" rel="stylesheet">
    <link href="https://goetzrieger.github.io/css/theme.css?1625070012" rel="stylesheet">
    <link href="https://goetzrieger.github.io/css/tabs.css?1625070012" rel="stylesheet">
    <link href="https://goetzrieger.github.io/css/hugo-theme.css?1625070012" rel="stylesheet">
    
    <link href="https://goetzrieger.github.io/css/theme-red.css?1625070012" rel="stylesheet">
    
    

    <script src="https://goetzrieger.github.io/js/jquery-3.3.1.min.js?1625070012"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
        :not(pre) > code + span.copy-to-clipboard {
            display: none;
        }
      
    </style>
    
  </head>
  <body class="" data-url="/ansible-tower-getting-started/2-cred/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="https://goetzrieger.github.io/">
  <img src="https://goetzrieger.github.io/images/email_ansiblefest-2020.png">
</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="https://goetzrieger.github.io/js/lunr.min.js?1625070012"></script>
<script type="text/javascript" src="https://goetzrieger.github.io/js/auto-complete.js?1625070012"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/goetzrieger.github.io\/";
    
</script>
<script type="text/javascript" src="https://goetzrieger.github.io/js/search.js?1625070012"></script>

    
  </div>
  
    <section id="homelinks">
      <ul>
        <li>
            <a class="padding" href='https://goetzrieger.github.io/'><i class='fas fa-home'></i> Home</a>
        </li>
      </ul>
    </section>
  

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/ansible-getting-started/" title="Ansible Getting Started" class="dd-item
        
        
        
        ">
      <a href="https://goetzrieger.github.io/ansible-getting-started/">
          Ansible Getting Started
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/ansible-getting-started/1-setup/" title="Check the Prerequisites" class="dd-item
        
        
        
        ">
      <a href="https://goetzrieger.github.io/ansible-getting-started/1-setup/">
          Check the Prerequisites
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-getting-started/2-adhoc/" title="Running ad hoc commands" class="dd-item
        
        
        
        ">
      <a href="https://goetzrieger.github.io/ansible-getting-started/2-adhoc/">
          Running ad hoc commands
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-getting-started/3-playbook/" title="Writing Your First Playbook" class="dd-item
        
        
        
        ">
      <a href="https://goetzrieger.github.io/ansible-getting-started/3-playbook/">
          Writing Your First Playbook
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-getting-started/4-variables/" title="Using Variables" class="dd-item
        
        
        
        ">
      <a href="https://goetzrieger.github.io/ansible-getting-started/4-variables/">
          Using Variables
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-getting-started/5-handlers/" title="Conditionals, Handlers and Loops" class="dd-item
        
        
        
        ">
      <a href="https://goetzrieger.github.io/ansible-getting-started/5-handlers/">
          Conditionals, Handlers and Loops
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-getting-started/6-templates/" title="Templates" class="dd-item
        
        
        
        ">
      <a href="https://goetzrieger.github.io/ansible-getting-started/6-templates/">
          Templates
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-getting-started/7-bonus/" title="Bonus Labs" class="dd-item
        
        
        
        ">
      <a href="https://goetzrieger.github.io/ansible-getting-started/7-bonus/">
          Bonus Labs
          
      </a>
      
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ansible-tower-getting-started/" title="Ansible Tower Getting Started" class="dd-item
        parent
        
        
        ">
      <a href="https://goetzrieger.github.io/ansible-tower-getting-started/">
          Ansible Tower Getting Started
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/ansible-tower-getting-started/1-intro/" title="Introduction to Automation Controller" class="dd-item
        
        
        
        ">
      <a href="https://goetzrieger.github.io/ansible-tower-getting-started/1-intro/">
          Introduction to Automation Controller
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-tower-getting-started/2-cred/" title="Inventories, credentials and ad hoc commands" class="dd-item
        
        active
        
        ">
      <a href="https://goetzrieger.github.io/ansible-tower-getting-started/2-cred/">
          Inventories, credentials and ad hoc commands
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-tower-getting-started/3-projects/" title="Projects &amp; job templates" class="dd-item
        
        
        
        ">
      <a href="https://goetzrieger.github.io/ansible-tower-getting-started/3-projects/">
          Projects &amp; job templates
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-tower-getting-started/4-surveys/" title="Surveys" class="dd-item
        
        
        
        ">
      <a href="https://goetzrieger.github.io/ansible-tower-getting-started/4-surveys/">
          Surveys
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-tower-getting-started/5-rbac/" title="Role-based access control" class="dd-item
        
        
        
        ">
      <a href="https://goetzrieger.github.io/ansible-tower-getting-started/5-rbac/">
          Role-based access control
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-tower-getting-started/6-workflows/" title="Workflows" class="dd-item
        
        
        
        ">
      <a href="https://goetzrieger.github.io/ansible-tower-getting-started/6-workflows/">
          Workflows
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-tower-getting-started/7-wrap/" title="Wrap up" class="dd-item
        
        
        
        ">
      <a href="https://goetzrieger.github.io/ansible-tower-getting-started/7-wrap/">
          Wrap up
          
      </a>
      
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ansible-tower-advanced/" title="Ansible Tower Advanced" class="dd-item
        
        
        
        ">
      <a href="https://goetzrieger.github.io/ansible-tower-advanced/">
          Ansible Tower Advanced
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/ansible-tower-advanced/1-intro/" title="Ansible Tower Advanced" class="dd-item
        
        
        
        ">
      <a href="https://goetzrieger.github.io/ansible-tower-advanced/1-intro/">
          Ansible Tower Advanced
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-tower-advanced/2-clustering/" title="Introduction to Ansible Tower Clustering" class="dd-item
        
        
        
        ">
      <a href="https://goetzrieger.github.io/ansible-tower-advanced/2-clustering/">
          Introduction to Ansible Tower Clustering
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-tower-advanced/3-awx-cli-intro/" title="There is more to Tower than the Web UI" class="dd-item
        
        
        
        ">
      <a href="https://goetzrieger.github.io/ansible-tower-advanced/3-awx-cli-intro/">
          There is more to Tower than the Web UI
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-tower-advanced/4-awx-cli-exercises/" title="Creating Tower Objects Using `awx`" class="dd-item
        
        
        
        ">
      <a href="https://goetzrieger.github.io/ansible-tower-advanced/4-awx-cli-exercises/">
          Creating Tower Objects Using `awx`
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-tower-advanced/5-tower-cluster-jobs/" title="Run a Job in a Cluster" class="dd-item
        
        
        
        ">
      <a href="https://goetzrieger.github.io/ansible-tower-advanced/5-tower-cluster-jobs/">
          Run a Job in a Cluster
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-tower-advanced/6-instance-groups/" title="Tower Instance Groups" class="dd-item
        
        
        
        ">
      <a href="https://goetzrieger.github.io/ansible-tower-advanced/6-instance-groups/">
          Tower Instance Groups
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-tower-advanced/7-parallel-jobs/" title="Parallel Jobs" class="dd-item
        
        
        
        ">
      <a href="https://goetzrieger.github.io/ansible-tower-advanced/7-parallel-jobs/">
          Parallel Jobs
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-tower-advanced/8-isolated-nodes/" title="Isolated Nodes" class="dd-item
        
        
        
        ">
      <a href="https://goetzrieger.github.io/ansible-tower-advanced/8-isolated-nodes/">
          Isolated Nodes
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-tower-advanced/9-advanced-inventories/" title="Advanced Inventories" class="dd-item
        
        
        
        ">
      <a href="https://goetzrieger.github.io/ansible-tower-advanced/9-advanced-inventories/">
          Advanced Inventories
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-tower-advanced/10-structured-content/" title="Well Structured Content Repositories" class="dd-item
        
        
        
        ">
      <a href="https://goetzrieger.github.io/ansible-tower-advanced/10-structured-content/">
          Well Structured Content Repositories
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-tower-advanced/11-rest-api/" title="Discovering the Tower API" class="dd-item
        
        
        
        ">
      <a href="https://goetzrieger.github.io/ansible-tower-advanced/11-rest-api/">
          Discovering the Tower API
          
      </a>
      
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ansible-collections/" title="Ansible Collections" class="dd-item
        
        
        
        ">
      <a href="https://goetzrieger.github.io/ansible-collections/">
          Ansible Collections
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/ansible-collections/1-introduction/" title="Introduction" class="dd-item
        
        
        
        ">
      <a href="https://goetzrieger.github.io/ansible-collections/1-introduction/">
          Introduction
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-collections/2-using-collections-from-playbooks/" title="Collections from Playbook" class="dd-item
        
        
        
        ">
      <a href="https://goetzrieger.github.io/ansible-collections/2-using-collections-from-playbooks/">
          Collections from Playbook
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-collections/3-using-collections-from-roles/" title="Collections from Roles" class="dd-item
        
        
        
        ">
      <a href="https://goetzrieger.github.io/ansible-collections/3-using-collections-from-roles/">
          Collections from Roles
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-collections/4-using-collections-from-tower/" title="Collections in Tower" class="dd-item
        
        
        
        ">
      <a href="https://goetzrieger.github.io/ansible-collections/4-using-collections-from-tower/">
          Collections in Tower
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-collections/5-creating-collections/" title="Creating Collections" class="dd-item
        
        
        
        ">
      <a href="https://goetzrieger.github.io/ansible-collections/5-creating-collections/">
          Creating Collections
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-collections/6-automation-hub-and-galaxy/" title="Use Automation Hub" class="dd-item
        
        
        
        ">
      <a href="https://goetzrieger.github.io/ansible-collections/6-automation-hub-and-galaxy/">
          Use Automation Hub
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/ansible-collections/6-automation-hub-and-galaxy/screenshots/" title="" class="dd-item
        
        
        
        ">
      <a href="https://goetzrieger.github.io/ansible-collections/6-automation-hub-and-galaxy/screenshots/">
          
          
      </a>
      
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vscode-intro/" title="Visual Studio Code - Introduction" class="dd-item
        
        
        
        ">
      <a href="https://goetzrieger.github.io/vscode-intro/">
          Visual Studio Code - Introduction
          
      </a>
      
      
    </li>
  
 

          
        
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li>
                  <a class="padding" href="https://goetzrieger.github.io/"><i class='fas fa-home'></i> Homepage</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="footer">
      <p></p>
    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='https://goetzrieger.github.io/'></a> > <a href='https://goetzrieger.github.io/ansible-tower-getting-started/'>Ansible Tower Getting Started</a> > Inventories, credentials and ad hoc commands
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#create-an-inventory">Create an Inventory</a></li>
    <li><a href="#machine-credentials">Machine Credentials</a></li>
    <li><a href="#configure-machine-credentials">Configure Machine Credentials</a></li>
    <li><a href="#hold-on-ansible-execution-environments-primer">Hold on: Ansible Execution Environments Primer!</a></li>
    <li><a href="#run-ad-hoc-commands">Run Ad Hoc Commands</a></li>
    <li><a href="#challenge-lab-ad-hoc-commands">Challenge Lab: Ad Hoc Commands</a></li>
    <li><a href="#execution-environments-a-deeper-look">Execution Environments: A deeper look</a></li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Inventories, credentials and ad hoc commands
            </h1>
          

        



	<h2 id="create-an-inventory">Create an Inventory</h2>
<p>Let’s get started: The first thing we need is an inventory of your managed hosts. This is the equivalent of an inventory file when using Ansible on the commandline. There is a lot more to it (like dynamic inventories) but let’s start with the basics.</p>
<ul>
<li>You should already have the web UI open, if not: Point your browser to the URL you were given, similar to <strong><code>https://student&lt;N&gt;.&lt;LABID&gt;.open.redhat.com</code></strong> (replace &ldquo;&lt;N&gt;&rdquo; and &ldquo;&lt;LABID&gt;&rdquo;) and log in as <code>admin</code> with the password given on the lab landing page.</li>
</ul>
<p>Create the inventory:</p>
<ul>
<li>
<p>In the web UI menu on the left side, go to <strong>Resources</strong> → <strong>Inventories</strong>, click the <img src="../../images/blue_add_dd.png?classes=inline" alt="Add"> drop-down and choose <strong>Add Inventory</strong>.</p>
</li>
<li>
<p><strong>Name:</strong> Workshop Inventory</p>
</li>
<li>
<p><strong>Organization:</strong> Default</p>
</li>
<li>
<p>Click <strong>Save</strong></p>
</li>
</ul>
<p>Go back to the <strong>Inventories</strong> list, your new <strong>Workshop Inventory</strong> should show up. Open the <strong>Workshop Inventory</strong> and click the <strong>Hosts</strong> tab, the list will be empty since we have not added any hosts yet.</p>
<p>So let&rsquo;s add some hosts. As mentioned in the intro you have three managed hosts in your lab environment, the names are resolved through the <code>/etc/hosts</code> file. The nodes are named <code>node1</code>, <code>node2</code> and <code>node3</code>.</p>
<p>Now add the hosts to the inventory in Automation Controller:</p>
<ul>
<li>
<p>Click the blue <img src="../../images/blue_add.png?classes=inline" alt="Add"> button.</p>
</li>
<li>
<p><strong>Name:</strong> node1</p>
</li>
<li>
<p>Click <strong>Save</strong></p>
</li>
<li>
<p>Click the <strong>Back to Hosts</strong> button and repeat to add <strong>node2</strong> as a second and <strong>node3</strong> as a third node.</p>
</li>
</ul>
<p>You have now created an inventory with three managed hosts.</p>
<h2 id="machine-credentials">Machine Credentials</h2>
<p>One of the great features of Automation Controller is to make credentials usable to users without making them visible. To allow Automation Controller to execute jobs on remote hosts, you must configure connection credentials.</p>

<div class="notices tip" ><p>This is one of the most important features of Automation Controller: <strong>Credential Separation</strong>! Credentials are defined separately and not with the hosts or inventory settings.</p>
</div>

<p>As this is an important part of your Automation Controller setup, why not make sure that connecting to the managed nodes from Automation Controller is working in the first place?</p>
<p>To test access to the nodes via SSH do the following:</p>
<ul>
<li>
<p>In your browser bring up the terminal window in code-server (remember this runs on the Automation Controller node).</p>
</li>
<li>
<p>From here as user <code>ec2-user</code> SSH into <code>node1</code> or one of the other nodes and execute <code>sudo -i</code>.</p>
</li>
</ul>

<div class="notices tip" ><p>In your lab environment SSH key authentication has already been configured.</p>
</div>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>ansible-1 ~<span style="color:#f92672">]</span>$ ssh ec2-user@node1
<span style="color:#f92672">[</span>ec2-user@node1 ~<span style="color:#f92672">]</span>$
sudo -i
<span style="color:#f92672">[</span>root@node1 ~<span style="color:#f92672">]</span><span style="color:#75715e"># exit</span>
<span style="color:#f92672">[</span>ec2-user@node1 ~<span style="color:#f92672">]</span>$ exit
</code></pre></div><p>What does this mean?</p>
<ul>
<li>
<p>Automation Controller user <strong>student&lt;N&gt;</strong> can connect to the managed hosts with SSH key authentication as user <strong>ec2-user</strong>.</p>
</li>
<li>
<p>User <strong>ec2-user</strong> can execute commands on the managed hosts as <strong>root</strong> with <code>sudo</code>.</p>
</li>
</ul>
<h2 id="configure-machine-credentials">Configure Machine Credentials</h2>
<p>Now we will configure the credentials to access our managed hosts from Automation Controller. In the <strong>Resources</strong> menu choose <strong>Credentials</strong>. Now:</p>
<p>Click the <img src="../../images/blue_add.png?classes=inline" alt="Add"> button to add new credentials</p>
<ul>
<li>
<p><strong>Name:</strong> Workshop Credentials</p>
</li>
<li>
<p><strong>Organization:</strong> Click on the magnifying glass, pick <strong>Default</strong> and click <strong>Select</strong></p>
</li>
<li>
<p><strong>Credential Type:</strong> Open the drop-down menu, and pick the type <strong>Machine</strong></p>
</li>
<li>
<p><strong>Username:</strong> ec2-user</p>
</li>
<li>
<p><strong>Privilege Escalation Method:</strong> sudo</p>
</li>
</ul>
<p>As we are using SSH key authentication, you have to provide an SSH private key that can be used to access the hosts. You could also configure password authentication here.</p>
<p>Bring up your code-server terminal on Automation Controller, and <code>cat</code> the SSH private key:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">[</span>ansible-1 ~<span style="color:#f92672">]</span>$ cat .ssh/aws-private.pem
-----BEGIN RSA PRIVATE KEY-----
MIIEpAIBAAKCAQEA2nnL3m5sKvoSy37OZ8DQCTjTIPVmCJt/M02KgDt53+baYAFu1TIkC3Yk+HK1
<span style="color:#f92672">[</span>...<span style="color:#f92672">]</span>
-----END RSA PRIVATE KEY-----
</code></pre></div><ul>
<li>
<p>Copy the <strong>complete private key</strong> (including &ldquo;BEGIN&rdquo; and &ldquo;END&rdquo; lines) and paste it into the <strong>SSH Private Key</strong> field in the web UI.</p>
</li>
<li>
<p>Click <strong>Save</strong></p>
</li>
</ul>
<p>Your new credentials have been created, go back to the <strong>Resources -&gt; Credentials -&gt; Workshop Credentials</strong> and note that the SSH key is not visible but shown as &ldquo;encrypted&rdquo;.</p>
<p>You have now setup credentials for Ansible to access your managed hosts.</p>
<h2 id="hold-on-ansible-execution-environments-primer">Hold on: Ansible Execution Environments Primer!</h2>
<p>Before you run your first Ansible ad hoc commands in Automation Controller it&rsquo;s about time to learn about one of the major new features in Ansible Automation Platform 2: <strong>Execution Environments</strong>!</p>
<p>Before AAP 2 the Automation Platform execution relied on using <strong>bubblewrap</strong> to isolate processes and Python virtual environments (venv) to sandbox dependencies. This lead to a number of issues like maintaining multiple venv, migrating Ansible content between execution nodes and much more. The concept of execution environments (EE) solves this by using Linux containers.</p>
<p>An EE is a container run from an image that contains everything your Ansible Playbook needs to run. It&rsquo;s basically a control node in a box that can be executed everywhere a Linux container can run. There are ready-made image that contain everything you would expect on an Ansible control node, but you can (and probably will) start to build your own, custom image for your very own requirements at some point.</p>
<p>Your Automation Controller has been preconfigured with some standard EE images. So first go through the next section covering ad hoc commands, we&rsquo;ll look into execution environments a bit deeper later.</p>

<div class="notices tip" ><p>Linux containers are technologies that allow you to package and isolate applications with their entire runtime environment. This makes it easy to move the contained application between environments and nodes while retaining full functionality.
In this lab you&rsquo;ll use the command <code>podman</code> later on. Podman is a daemonless container engine for developing, managing, and running Open Container Initiative (OCI) containers and container images on your Linux System. If you want to learn more, there is a wealth of information on the Internet, you could start <a href="http://docs.podman.io/en/latest/Introduction.html">here</a> for Podman or <a href="https://www.ansible.com/blog/introduction-to-ansible-builder">here</a> for execution environments.</p>
</div>

<h2 id="run-ad-hoc-commands">Run Ad Hoc Commands</h2>
<p>As you’ve probably done with Ansible before you can run ad hoc commands from Automation Controller as well.</p>
<ul>
<li>
<p>In the web UI go to <strong>Resources → Inventories → Workshop Inventory</strong></p>
</li>
<li>
<p>Click the <strong>Hosts</strong> button to change into the hosts view and select the three hosts by checking the boxes to the left of the host entries.</p>
</li>
<li>
<p>Click <strong>Run Command</strong>. In the next screen you have to specify the ad hoc command:</p>
<ul>
<li>
<p>As <strong>Module</strong> choose <strong>ping</strong></p>
</li>
<li>
<p>Click <strong>Next</strong></p>
</li>
<li>
<p>As <strong>Execution Environment</strong> choose <strong>Controller Default EE</strong></p>
</li>
<li>
<p>Click <strong>Next</strong></p>
</li>
<li>
<p>For <strong>Machine Credential</strong> choose <strong>Workshop Credentials</strong>.</p>
</li>
<li>
<p>Click <strong>Launch</strong>, and watch the output. It should report <strong>SUCCESS</strong> for all nodes, of course.</p>
</li>
</ul>
</li>
</ul>
<p>The simple <strong>ping</strong> module doesn’t need options. For other modules you need to supply the command to run as an argument. Run another ad hoc command, this time try the <strong>command</strong> module to find the user ID of the executing user using an ad hoc command.</p>
<ul>
<li>
<p><strong>Module:</strong> command</p>
</li>
<li>
<p><strong>Arguments:</strong> id</p>
</li>
</ul>
<p>How about trying to get some more private information from the system? Try to print out <strong>/etc/shadow</strong>.</p>
<ul>
<li>
<p><strong>Module:</strong> command</p>
</li>
<li>
<p><strong>Arguments:</strong> cat /etc/shadow</p>
</li>
</ul>

<div class="notices warning" ><p>Expect an error!</p>
</div>

<p>Oops, the last one didn’t went well, all red.</p>
<p>Re-run the last ad hoc command but this time tick the <strong>Enable Privilege Escalation</strong> box.</p>
<p>As you see, this time it worked. For tasks that have to run as root you need to escalate the privileges. This is the same as the <strong>become: yes</strong> you’ve probably used often in your Ansible Playbooks.</p>
<h2 id="challenge-lab-ad-hoc-commands">Challenge Lab: Ad Hoc Commands</h2>
<p>Okay, a small challenge: Run an ad hoc to make sure the package &ldquo;tmux&rdquo; is installed on all hosts. If unsure, consult the Ansible documentation either via the web or by running <code>ansible-doc yum</code> in the VS Code terminal on your Automation Controller control host.</p>
<details><summary><b>Click here for Solution</b></summary>
<hr/>
<p>
<ul>
<li>
<p><strong>Module:</strong> yum</p>
</li>
<li>
<p><strong>Arguments:</strong> name=tmux</p>
</li>
<li>
<p>Tick <strong>Enable Privilege Escalation</strong></p>
</li>
</ul>
</p>
<hr/>
</details>

<div class="notices tip" ><p>The yellow output of the command indicates Ansible has actually done something (here it needed to install the package). If you run the ad hoc command a second time, the output will be green and inform you that the package was already installed. So yellow in Ansible doesn’t mean &ldquo;be careful&rdquo;…​ ;-).</p>
</div>


<div class="notices tip" ><p>Try to click one of the output lines in the window showing the job output. A small window with a lot of information about the job like module args will open. Have a look and close it again.</p>
</div>

<h2 id="execution-environments-a-deeper-look">Execution Environments: A deeper look</h2>
<p>As promised let&rsquo;s look a bit deeper into execution environments. During the section covering ad hoc commands you have already seen you have to choose an execution environment, the same will hold true for running Playbooks later on. In your Automation Controller web UI, go to <strong>Administration → Execution Environments</strong>. You&rsquo;ll see a list of the configured execution environments and original location of the image, in our case the images are provided in the <strong>quay.io</strong> container registry. Here you could add your own registry with custom EE images, too.</p>
<p>So what happens, when Automation Controller runs an ad hoc command or Playbook? Let&rsquo;s see&hellip;</p>
<p>You should already have your <strong>VS Code</strong> terminal open in another browser tab, if not open https://student&lt;N&gt;-code.&lt;LABID&gt;.open.redhat.com and do <strong>Terminal -&gt; New Terminal</strong>. In this terminal:</p>
<ul>
<li>
<p>You should be your <strong>student&lt;N&gt;</strong> user, become the <strong>awx</strong> user by running <code>sudo -u awx -i</code></p>
</li>
<li>
<p>First let&rsquo;s look for the image:</p>
</li>
</ul>
<pre><code>[awx@ansible-1 ~]$ podman images
REPOSITORY              TAG     IMAGE ID      CREATED       SIZE
quay.io/ansible/awx-ee  0.2.0   68b8d8c4702d  2 months ago  1.25 GB
</code></pre><ul>
<li>
<p>It was pulled from the registry to be available locally.</p>
</li>
<li>
<p>Now we want to observe how an EE is run as a container when you execute your automation. <code>podman ps -w 2</code> will list running containers, the <code>-w</code> option updates the output regularly. Run the command, at first it will show you something like this (no container running):</p>
</li>
</ul>
<pre><code>CONTAINER ID  IMAGE   COMMAND  CREATED  STATUS  PORTS   NAMES
</code></pre><ul>
<li>
<p>Keep podman running, now it&rsquo;s time to execute some automation.</p>
</li>
<li>
<p>In the web UI run an ad hoc command again. Go to <strong>Resources → Inventories → Workshop Inventory</strong></p>
</li>
<li>
<p>In the <strong>Hosts</strong> view select the three hosts.</p>
</li>
<li>
<p>Click <strong>Run Command</strong>. Specify the ad hoc command as you did before:</p>
<ul>
<li>
<p><strong>Module</strong>: command</p>
</li>
<li>
<p><strong>Arguments</strong>: sleep 60</p>
</li>
<li>
<p><strong>Next</strong></p>
</li>
<li>
<p><strong>Execution Environment</strong>: Controller Default EE</p>
</li>
<li>
<p><strong>Next</strong></p>
</li>
<li>
<p><strong>Machine Credential</strong>: Workshop Credentials</p>
</li>
<li>
<p>Click <strong>Launch</strong></p>
</li>
</ul>
</li>
</ul>
<p>Now go back to the <strong>VS Code</strong> terminal. You&rsquo;ll see a container is launched to run the ad hoc command and then removed again:</p>
<pre><code>CONTAINER ID  IMAGE                         COMMAND               CREATED       STATUS            PORTS   NAMES
c8e9a13ab475  quay.io/ansible/awx-ee:0.2.0  ssh-agent sh -c t...  1 second ago  Up 2 seconds ago          ansible_runner_18
</code></pre>
<div class="notices tip" ><p>The <code>sleep 60</code> command was only used to keep the container running for some time. Your output will differ slightly.</p>
</div>

<ul>
<li>
<p>Feel free to relaunch the job again!</p>
</li>
<li>
<p>Stop <code>podman</code> with <code>CTRL-C</code>.</p>
</li>
</ul>
<p>This is how Automation Controller uses Linux containers to run Ansible automation jobs in their own dedicated environments.</p>





<footer class=" footline" >
	
</footer>

        
        </div>
        

      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        

        


	 
	 
		
			<a class="nav nav-prev" href="https://goetzrieger.github.io/ansible-tower-getting-started/1-intro/" title="Introduction to Automation Controller"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="https://goetzrieger.github.io/ansible-tower-getting-started/3-projects/" title="Projects &amp; job templates" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="https://goetzrieger.github.io/js/clipboard.min.js?1625070012"></script>
    <script src="https://goetzrieger.github.io/js/perfect-scrollbar.min.js?1625070012"></script>
    <script src="https://goetzrieger.github.io/js/perfect-scrollbar.jquery.min.js?1625070012"></script>
    <script src="https://goetzrieger.github.io/js/jquery.sticky.js?1625070012"></script>
    <script src="https://goetzrieger.github.io/js/featherlight.min.js?1625070012"></script>
    <script src="https://goetzrieger.github.io/js/highlight.pack.js?1625070012"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="https://goetzrieger.github.io/js/modernizr.custom-3.6.0.js?1625070012"></script>
    <script src="https://goetzrieger.github.io/js/learn.js?1625070012"></script>
    <script src="https://goetzrieger.github.io/js/hugo-learn.js?1625070012"></script>
    
        
            <script src="https://goetzrieger.github.io/mermaid/mermaid.js?1625070012"></script>
        
        <script>
            mermaid.initialize({ startOnLoad: true });
        </script>
    
    

  </body>
</html>
