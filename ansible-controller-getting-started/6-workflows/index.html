<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.69.0" />
    <meta name="description" content="Ansible and Ansible Automation Platform Labs">
<meta name="author" content="Christian, Eric, Götz">

    <link rel="icon" href="https://ansible-labs-crew.github.io/images/favicon.png" type="image/png">

    <title>Workflows :: Ansible Labs for Red Hat Summit 2021</title>

    
    <link href="https://ansible-labs-crew.github.io/css/nucleus.css?1632320281" rel="stylesheet">
    <link href="https://ansible-labs-crew.github.io/css/fontawesome-all.min.css?1632320281" rel="stylesheet">
    <link href="https://ansible-labs-crew.github.io/css/hybrid.css?1632320281" rel="stylesheet">
    <link href="https://ansible-labs-crew.github.io/css/featherlight.min.css?1632320281" rel="stylesheet">
    <link href="https://ansible-labs-crew.github.io/css/perfect-scrollbar.min.css?1632320281" rel="stylesheet">
    <link href="https://ansible-labs-crew.github.io/css/auto-complete.css?1632320281" rel="stylesheet">
    <link href="https://ansible-labs-crew.github.io/css/atom-one-dark-reasonable.css?1632320281" rel="stylesheet">
    <link href="https://ansible-labs-crew.github.io/css/theme.css?1632320281" rel="stylesheet">
    <link href="https://ansible-labs-crew.github.io/css/tabs.css?1632320281" rel="stylesheet">
    <link href="https://ansible-labs-crew.github.io/css/hugo-theme.css?1632320281" rel="stylesheet">
    
    <link href="https://ansible-labs-crew.github.io/css/theme-red.css?1632320281" rel="stylesheet">
    
    

    <script src="https://ansible-labs-crew.github.io/js/jquery-3.3.1.min.js?1632320281"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
        :not(pre) > code + span.copy-to-clipboard {
            display: none;
        }
      
    </style>
    
  </head>
  <body class="" data-url="/ansible-controller-getting-started/6-workflows/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="https://ansible-labs-crew.github.io/">
  <img src="https://ansible-labs-crew.github.io/images/summit-2021.png">
</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="https://ansible-labs-crew.github.io/js/lunr.min.js?1632320281"></script>
<script type="text/javascript" src="https://ansible-labs-crew.github.io/js/auto-complete.js?1632320281"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/ansible-labs-crew.github.io\/";
    
</script>
<script type="text/javascript" src="https://ansible-labs-crew.github.io/js/search.js?1632320281"></script>

    
  </div>
  
    <section id="homelinks">
      <ul>
        <li>
            <a class="padding" href='https://ansible-labs-crew.github.io/'><i class='fas fa-home'></i> Home</a>
        </li>
      </ul>
    </section>
  

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/ansible-getting-started/" title="Ansible Getting Started" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-getting-started/">
          Ansible Getting Started
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/ansible-getting-started/1-setup/" title="Check the Prerequisites" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-getting-started/1-setup/">
          Check the Prerequisites
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-getting-started/2-adhoc/" title="Running ad hoc commands" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-getting-started/2-adhoc/">
          Running ad hoc commands
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-getting-started/3-playbook/" title="Writing Your First Playbook" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-getting-started/3-playbook/">
          Writing Your First Playbook
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-getting-started/4-variables/" title="Using Variables" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-getting-started/4-variables/">
          Using Variables
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-getting-started/5-handlers/" title="Conditionals, Handlers and Loops" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-getting-started/5-handlers/">
          Conditionals, Handlers and Loops
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-getting-started/6-templates/" title="Templates" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-getting-started/6-templates/">
          Templates
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-getting-started/7-bonus/" title="Bonus Labs" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-getting-started/7-bonus/">
          Bonus Labs
          
      </a>
      
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ansible-controller-getting-started/" title="Ansible automation controller getting started" class="dd-item
        parent
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-getting-started/">
          Ansible automation controller getting started
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-getting-started/1-intro/" title="Introduction to automation controller" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-getting-started/1-intro/">
          Introduction to automation controller
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-getting-started/2-cred/" title="Inventories, credentials and ad hoc commands" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-getting-started/2-cred/">
          Inventories, credentials and ad hoc commands
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-getting-started/3-projects/" title="Projects &amp; job templates" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-getting-started/3-projects/">
          Projects &amp; job templates
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-getting-started/4-surveys/" title="Surveys" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-getting-started/4-surveys/">
          Surveys
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-getting-started/5-rbac/" title="Role-based access control" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-getting-started/5-rbac/">
          Role-based access control
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-getting-started/6-workflows/" title="Workflows" class="dd-item
        
        active
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-getting-started/6-workflows/">
          Workflows
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-getting-started/7-wrap/" title="Wrap up" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-getting-started/7-wrap/">
          Wrap up
          
      </a>
      
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ansible-controller-advanced/" title="Ansible automation controller advanced" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-advanced/">
          Ansible automation controller advanced
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-advanced/1-intro/" title="Introduction to your lab" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-advanced/1-intro/">
          Introduction to your lab
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-advanced/2-clustering/" title="Introduction to automation controller clustering" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-advanced/2-clustering/">
          Introduction to automation controller clustering
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-advanced/3-awx-collection-intro/" title="There is more to automation controller than the Web UI" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-advanced/3-awx-collection-intro/">
          There is more to automation controller than the Web UI
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-advanced/4-cluster-jobs/" title="Run a Job in a Cluster" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-advanced/4-cluster-jobs/">
          Run a Job in a Cluster
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-advanced/5-instance-groups/" title="automation controller instance groups" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-advanced/5-instance-groups/">
          automation controller instance groups
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-advanced/6-parallel-jobs/" title="Parallel Jobs" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-advanced/6-parallel-jobs/">
          Parallel Jobs
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-advanced/7-advanced-inventories/" title="Advanced Inventories" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-advanced/7-advanced-inventories/">
          Advanced Inventories
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-advanced/8-structured-content/" title="Well Structured Content Repositories" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-advanced/8-structured-content/">
          Well Structured Content Repositories
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-controller-advanced/9-rest-api/" title="Discovering the automation controller API" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-controller-advanced/9-rest-api/">
          Discovering the automation controller API
          
      </a>
      
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/ansible-collections/" title="Ansible Collections" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-collections/">
          Ansible Collections
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/ansible-collections/1-introduction/" title="Introduction" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-collections/1-introduction/">
          Introduction
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-collections/2-using-collections-from-playbooks/" title="Collections from Playbook" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-collections/2-using-collections-from-playbooks/">
          Collections from Playbook
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-collections/3-using-collections-from-roles/" title="Collections from Roles" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-collections/3-using-collections-from-roles/">
          Collections from Roles
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-collections/4-using-collections-from-tower/" title="Collections in automation controller" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-collections/4-using-collections-from-tower/">
          Collections in automation controller
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-collections/5-creating-collections/" title="Creating Collections" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-collections/5-creating-collections/">
          Creating Collections
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/ansible-collections/6-automation-hub-and-galaxy/" title="Use Automation Hub" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-collections/6-automation-hub-and-galaxy/">
          Use Automation Hub
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/ansible-collections/6-automation-hub-and-galaxy/screenshots/" title="" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/ansible-collections/6-automation-hub-and-galaxy/screenshots/">
          
          
      </a>
      
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/vscode-intro/" title="Visual Studio Code - Introduction" class="dd-item
        
        
        
        ">
      <a href="https://ansible-labs-crew.github.io/vscode-intro/">
          Visual Studio Code - Introduction
          
      </a>
      
      
    </li>
  
 

          
        
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li>
                  <a class="padding" href="https://goetzrieger.github.io/"><i class='fas fa-home'></i> Homepage</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="footer">
      <p></p>
    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='https://ansible-labs-crew.github.io/'></a> > <a href='https://ansible-labs-crew.github.io/ansible-controller-getting-started/'>Ansible automation controller getting started</a> > Workflows
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#lab-scenario">Lab Scenario</a></li>
    <li><a href="#set-up-projects">Set up Projects</a></li>
    <li><a href="#set-up-job-templates">Set up Job Templates</a></li>
    <li><a href="#set-up-the-workflow">Set up the Workflow</a></li>
    <li><a href="#and-action">And Action</a></li>
    <li><a href="#workflow-approvals">Workflow Approvals</a></li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Workflows
            </h1>
          

        



	<p>The basic idea of an automation controller workflow is to link multiple Job Templates together. They may or may not share inventory, Playbooks or even permissions. The links can be conditional:</p>
<ul>
<li>
<p>If job template A succeeds, job template B is automatically executed afterwards.</p>
</li>
<li>
<p>In case of a failure, job template C will be run.</p>
</li>
</ul>
<p>And the workflows are not even limited to Job Templates, but can also include project or inventory updates.</p>
<p>This enables new applications for automation controller: different Job Templates can build upon each other. E.g. the networking team creates playbooks with their own content, in their own Git repository and even targeting their own inventory, while the operations team also has their own repos, playbooks and inventory.</p>
<p>In this lab you’ll learn how to setup a workflow.</p>
<h2 id="lab-scenario">Lab Scenario</h2>
<p>You have two departments in your organization:</p>
<ul>
<li>
<p>The web operations team that is developing Playbooks for deploying web infrastructures in their own Git repository.</p>
</li>
<li>
<p>The web applications team, that develops JavaScript web applications for NodeJS in their Git repository.</p>
</li>
</ul>
<p>When there is a new NodeJS-based website to deploy, two main steps need to happen:</p>
<p>The web operations team has to:</p>
<ul>
<li>
<p>Install and configure NodeJS to run as a service.</p>
</li>
<li>
<p>An Apache instance needs to be installed and configured as proxy to pass requests for the NodeJS content to the NodeJS backend. And a lot of other steps might be needed, too. Like SELinux, firewall&hellip; you know the drill.</p>
</li>
</ul>
<p>The web developer team has to:</p>
<ul>
<li>
<p>Deploy the most recent version of the JavaScript web application.</p>
</li>
<li>
<p>Make sure everything is prepared to run the application like the directory structure and service restarts.</p>
</li>
</ul>
<p>To make things somewhat easier for you, everything needed already exists in a Github repository: Playbooks, JavaScript files etc. You just need to glue it together.</p>
<h2 id="set-up-projects">Set up Projects</h2>
<p>First you have to set up the Git repo as Projects like you normally would. You have done this before, try to do this on your own. Detailed instructions can be found below.</p>

<div class="notices warning" ><p>If you are still logged in as user <strong>wweb</strong>, log out of and log in as user <strong>admin</strong> again.</p>
</div>

<ul>
<li>
<p>Create the project for web operations:</p>
<ul>
<li>
<p>It should be named <strong>Webops Git Repo</strong>.</p>
</li>
<li>
<p>The URL to access the repo is <strong>https://github.com/ansible-labs-crew/playbooks_ops_summit2021.git</strong></p>
</li>
</ul>
</li>
<li>
<p>Create the project for the application developers:</p>
<ul>
<li>
<p>It should be named <strong>Webdev Git Repo</strong>.</p>
</li>
<li>
<p>The URL to access the repo is <strong>https://github.com/ansible-labs-crew/playbooks_dev_summit2021.git</strong></p>
</li>
</ul>
</li>
</ul>
<details><summary><b>Click here for Solution</b></summary>
<hr/>
<p>
<ul>
<li>
<p>Create the project for web operations. In the <strong>Projects</strong> view click the blue <strong>Add</strong> button and fill in:</p>
<ul>
<li>
<p><strong>Name:</strong> Webops Git Repo</p>
</li>
<li>
<p><strong>Organization:</strong> Default</p>
</li>
<li>
<p><strong>Source Control Credential Type:</strong> Git</p>
</li>
<li>
<p><strong>Source Control URL:</strong> https://github.com/ansible-labs-crew/playbooks_ops_summit2021.git</p>
</li>
<li>
<p><strong>Options:</strong> Clean, Delete, Update Revision on Launch</p>
</li>
</ul>
</li>
<li>
<p>Click <strong>Save</strong></p>
</li>
<li>
<p>Create the project for the application developers. In the <strong>Projects</strong> view click the blue <strong>Add</strong> button and fill in:</p>
<ul>
<li>
<p><strong>Name:</strong> Webdev Git Repo</p>
</li>
<li>
<p><strong>Organization:</strong> Default</p>
</li>
<li>
<p><strong>Source Control Credential Type:</strong> Git</p>
</li>
<li>
<p><strong>Source Control URL:</strong> https://github.com/ansible-labs-crew/playbooks_dev_summit2021.git</p>
</li>
<li>
<p><strong>Options:</strong> Clean, Delete, Update Revision on Launch</p>
</li>
</ul>
</li>
<li>
<p>Click <strong>Save</strong></p>
</li>
</ul>
</p>
<hr/>
</details>
<h2 id="set-up-job-templates">Set up Job Templates</h2>
<p>Now you have to create Job Templates like you would for &ldquo;normal&rdquo; Jobs.</p>

<div class="notices tip" ><p>We want to install the <strong>NodeJS app on node3 only</strong>. The Inventory <strong>Workshop Inventory</strong> contains all nodes, but we can limit the nodes using the <strong>LIMIT</strong> field!</p>
</div>

<ul>
<li>
<p>Go to the <strong>Templates</strong> view, click the <img src="../../images/blue_add.png?classes=inline" alt="Add"> and choose <strong>Add job template</strong>:</p>
<ul>
<li>
<p><strong>Name:</strong> Web Infra Deploy</p>
</li>
<li>
<p><strong>Job Type:</strong> Run</p>
</li>
<li>
<p><strong>Inventory:</strong> Workshop Inventory</p>
</li>
<li>
<p><strong>Project:</strong> Webops Git Repo</p>
</li>
<li>
<p><strong>Execution Environment:</strong> Default execution environment</p>
</li>
<li>
<p><strong>Playbook:</strong> <code>web_infrastructure.yml</code></p>
</li>
<li>
<p><strong>Credentials:</strong> Workshop Credentials</p>
</li>
<li>
<p><strong>Limit:</strong> node3.&lt;GUID&gt;.internal</p>
</li>
<li>
<p><strong>Options:</strong> Privilege Escalation</p>
</li>
</ul>
</li>
<li>
<p>Click <strong>Save</strong></p>
</li>
<li>
<p>Go to the <strong>Templates</strong> view again, <img src="../../images/blue_add.png?classes=inline" alt="Add"> and choose <strong>Add job template</strong>:</p>
<ul>
<li>
<p><strong>Name:</strong> Web App Deploy</p>
</li>
<li>
<p><strong>Job Type:</strong> Run</p>
</li>
<li>
<p><strong>Inventory:</strong> Workshop Inventory</p>
</li>
<li>
<p><strong>Project:</strong> Webdev Git Repo</p>
</li>
<li>
<p><strong>Execution Environment:</strong> Default execution environment</p>
</li>
<li>
<p><strong>Playbook:</strong> <code>install_node_app.yml</code></p>
</li>
<li>
<p><strong>Credentials:</strong> Workshop Credentials</p>
</li>
<li>
<p><strong>Limit:</strong> node3,&lt;GUID&gt;.internal</p>
</li>
<li>
<p><strong>OPTIONS:</strong> Privilege Escalation</p>
</li>
</ul>
</li>
<li>
<p>Click <strong>Save</strong></p>
</li>
</ul>

<div class="notices tip" ><p>If you want to know what the Playbooks look like, check out the Github URL.</p>
</div>

<h2 id="set-up-the-workflow">Set up the Workflow</h2>
<p>And now you finally set up the Workflow. Workflows are configured in the <strong>Templates</strong> view, you might have noticed you can choose between <strong>Add job template</strong> and <strong>Add workflow template</strong> when adding a template so this is finally making sense.</p>
<ul>
<li>
<p>Go to the <strong>Templates</strong> view and click the <img src="../../images/blue_add.png?classes=inline" alt="Add"> button. This time choose <strong>Add workflow template</strong></p>
<ul>
<li>
<p><strong>Name:</strong> Deploy Webapplication</p>
</li>
<li>
<p><strong>Organization:</strong> Default</p>
</li>
</ul>
</li>
<li>
<p>Click <strong>Save</strong></p>
</li>
<li>
<p>After saving the template the <strong>Workflow Visualizer</strong> opens to allow you to build a workflow. You can later open the <strong>Workflow Visualizer</strong> again by using the button on the template details page.</p>
</li>
<li>
<p>Click on the <strong>Start</strong> button, a dialog to configure a new <strong>workflow node</strong> opens.</p>
</li>
<li>
<p>First select the node type, you can choose between <strong>Job Template</strong>, <strong>Project Sync</strong>, <strong>Inventory Source Sync</strong>, <strong>Approval</strong> and <strong>Workflow Job Template</strong>.</p>
</li>
<li>
<p>Select <strong>Job Template</strong></p>
</li>
<li>
<p>Choose the <strong>Web Infra Deploy</strong> Template, you might have to switch pages.</p>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
</li>
</ul>
<p>You get into the <strong>Workflow Visualizer</strong> overview showing the first workflow node.</p>
<ul>
<li>
<p>The node gets annotated with the name of the job.</p>
</li>
<li>
<p>Hover the mouse pointer over the node, you’ll see a number of options appearing:</p>
<ul>
<li>
<p><strong>+</strong> to add a new workflow node</p>
</li>
<li>
<p><strong>i</strong> for Job Template details</p>
</li>
<li>
<p>a pencil icon to edit this node&rsquo;s settings</p>
</li>
<li>
<p>a link icon to link to another node</p>
</li>
<li>
<p>and a delete icon.</p>
</li>
</ul>
</li>
<li>
<p>We want to add another workflow node, click the <strong>+</strong> sign</p>
</li>
<li>
<p>You could now set the condition under which the next node is executed, select <strong>On Success</strong></p>
</li>
<li>
<p>Click <strong>Next</strong></p>
</li>
</ul>

<div class="notices tip" ><p>The type allows for more complex workflows. You could lay out different execution paths for successful and for failed Playbook runs.</p>
</div>

<ul>
<li>
<p>Choose <strong>Web App Deploy</strong> as the next Job.</p>
</li>
<li>
<p>Click <strong>Save</strong></p>
</li>
<li>
<p>Back in the main <strong>Workflow Visualizer</strong> view click <strong>Save</strong> in the upper right to save the Workflow Template.</p>
</li>
</ul>

<div class="notices tip" ><p>The <strong>Workflow Visualizer</strong> has options for setting up more advanced workflows, please refer to the <a href="https://docs.ansible.com/ansible-tower/latest/html/userguide/workflows.html">documentation</a>.</p>
</div>

<h2 id="and-action">And Action</h2>
<p>Your <strong>Deploy Webapplication</strong> workflow is ready to go, launch it.</p>
<ul>
<li>Click the <strong>Launch</strong> button directly or go to the the <strong>Templates</strong> view and launch the <strong>Deploy Webapplication</strong> workflow by clicking the rocket icon.</li>
</ul>
<p><img src="../../images/job_workflow.png" alt="jobs view of workflow"></p>
<p>Note how the workflow run is shown in the job view as a visual representation of the different workflow steps. Same as for a normal job template executions you can go to the <strong>Details</strong> tab to get more information. If you want to look at the actual Jobs behind the workflow nodes, click the workflow nodes. If you want to get back from a details view to the corresponding workflow, just hit your browsers back button.</p>
<p>After the job has finished, check if everything worked fine. In your <strong>VS Code</strong> terminal, run:</p>
<pre><code>[lab-user@bastion ~]$ curl http://node3.&lt;GUID&gt;.internal/nodejs
</code></pre>
<p>You should be greeted with a friendly <code>Hello World</code></p>
<h2 id="workflow-approvals">Workflow Approvals</h2>
<p>To make Workflows in automation controller even more useful you can add approval steps in your Workflow. Using this feature it&rsquo;s possible to have another user review and approve all or certain nodes in a Workflow. In addition you could set time limits, so a Workflow waiting for approval would be cancelled or proceed after time runs out automatically.</p>
<p>Let&rsquo;s see how this works by adding an approval step to the <strong>Deploy Webapplication</strong> Workflow Template you configured above. The goal is to:</p>
<ul>
<li>
<p>Allow user <strong>wweb</strong> to execute the workflow by allowing the team <strong>Web Content</strong> access.</p>
</li>
<li>
<p>To have a user do the approval.</p>
</li>
<li>
<p>Require an approval before the application is installed.</p>
</li>
</ul>
<p>Start with inserting the approval into the workflow:</p>
<ul>
<li>
<p>As user <strong>admin</strong> open the Workflow by going to <strong>Resources -&gt; Templates -&gt; Deploy Webapplication</strong>.</p>
</li>
<li>
<p>Click  <strong>Visualizer</strong> to open the Workflow editor.</p>
</li>
<li>
<p>Hover the mouse over the green connection line between the to nodes and click <strong>+</strong> to add another node.</p>
</li>
<li>
<p>As run condition choose <strong>Always</strong>.</p>
</li>
<li>
<p>Click <strong>Next</strong></p>
</li>
<li>
<p>Set <strong>Node Type</strong> to <strong>Approval</strong></p>
</li>
<li>
<p><strong>Name</strong>: approve app install</p>
</li>
<li>
<p><strong>Save</strong> and <strong>Save</strong> again for the workflow.</p>
</li>
</ul>
<p><img src="../../images/workflow_approval.png" alt="Workflow Approval"></p>
<p>Now give members of the team <strong>Web Content</strong> access rights to execute the Workflow. You did this in the RBAC excercise, basically do this:</p>
<ul>
<li>
<p>Go to the <strong>Access</strong> tab of the Workflow.</p>
</li>
<li>
<p>Click <img src="../../images/blue_add.png?classes=inline" alt="Add"> and add team <strong>Web Content</strong>.</p>
</li>
<li>
<p>Select the role <strong>Execute</strong></p>
</li>
<li>
<p><strong>Save</strong></p>
</li>
</ul>
<p>Log out and log in again as user <strong>wweb</strong> with password <code>ansible</code>.</p>
<ul>
<li>
<p>You should be able to execute the Workflow Template <strong>Deploy Webapplication</strong></p>
</li>
<li>
<p>Launch it</p>
</li>
<li>
<p>The workflow should be stuck in the <strong>approve app install</strong> step, waiting for approval.</p>
</li>
<li>
<p>In the upper right corner you&rsquo;ll see a notification <strong>1</strong> near to the bell icon. Click it.</p>
</li>
</ul>
<p><img src="../../images/approval_notification.png" alt="Approval Notification"></p>
<ul>
<li>You&rsquo;ll get to the <strong>Workflow Approvals</strong> view listing pending approvals.</li>
<li>If you check the box to the right of the approval, you&rsquo;ll note you <strong>can&rsquo;t approve</strong> because the <strong>Approve</strong> and <strong>Deny</strong> buttons stay inactive.</li>
</ul>
<p>No surprise, you don&rsquo;t have the permissions as user <strong>wweb</strong>. Log in as admin again and create the approval user (you did this before in the RBAC exercise):</p>
<ul>
<li>
<p><strong>Username:</strong> aapproval</p>
</li>
<li>
<p><strong>Password:</strong> ansible</p>
</li>
<li>
<p><strong>First Name:</strong> Anton</p>
</li>
<li>
<p><strong>Last name:</strong> Approval</p>
</li>
<li>
<p><strong>User Type:</strong> Normal User</p>
</li>
<li>
<p><strong>Save</strong></p>
</li>
</ul>

<div class="notices tip" ><p>You could of course approve the workflow as user <strong>admin</strong>, but we&rsquo;d like to create a dedicated user for this!</p>
</div>

<p>Now go back to the Workflow <strong>Deploy Webapplication</strong></p>
<ul>
<li>
<p>Open the <strong>Access</strong> tab</p>
</li>
<li>
<p>Add a <strong>aapproval</strong> as new user</p>
</li>
<li>
<p>Give the role <strong>Approve</strong></p>
</li>
<li>
<p><strong>Save</strong></p>
</li>
</ul>
<p>You&rsquo;re set. The Workflow run <strong>wweb</strong> started is still in pending state, you can check this by going to <strong>Views -&gt; Jobs</strong>, it will still be shown as running. Okay, let&rsquo;s approve it!</p>
<ul>
<li>
<p>Log out and in as user <strong>aapproval</strong></p>
</li>
<li>
<p>You&rsquo;ll again see the bell notification in the upper right, click it to get to the <strong>Workflow Approvals</strong> view.</p>
</li>
<li>
<p>Check the box to the left of the <strong>approve app install</strong> job.</p>
</li>
<li>
<p>You should now see the <strong>Approve</strong> and <strong>Deny</strong> buttons getting active!</p>
</li>
<li>
<p>Click the <strong>Approve</strong> button.</p>
</li>
<li>
<p>Go to <strong>Views -&gt; Jobs</strong> and click the <strong>Deploy Webapplicattion</strong> job.</p>
</li>
</ul>
<p>You&rsquo;ll see how the job picks up after you approved it and goes to the <strong>Web App Deploy</strong> node to finish.</p>
<p>This was a basic example to show how you could create a Job, allow one user to execute it and another user to approve it!</p>





<footer class=" footline" >
	
</footer>

        
        </div>
        

      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        

        


	 
	 
		
			<a class="nav nav-prev" href="https://ansible-labs-crew.github.io/ansible-controller-getting-started/5-rbac/" title="Role-based access control"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="https://ansible-labs-crew.github.io/ansible-controller-getting-started/7-wrap/" title="Wrap up" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="https://ansible-labs-crew.github.io/js/clipboard.min.js?1632320281"></script>
    <script src="https://ansible-labs-crew.github.io/js/perfect-scrollbar.min.js?1632320281"></script>
    <script src="https://ansible-labs-crew.github.io/js/perfect-scrollbar.jquery.min.js?1632320281"></script>
    <script src="https://ansible-labs-crew.github.io/js/jquery.sticky.js?1632320281"></script>
    <script src="https://ansible-labs-crew.github.io/js/featherlight.min.js?1632320281"></script>
    <script src="https://ansible-labs-crew.github.io/js/highlight.pack.js?1632320281"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="https://ansible-labs-crew.github.io/js/modernizr.custom-3.6.0.js?1632320281"></script>
    <script src="https://ansible-labs-crew.github.io/js/learn.js?1632320281"></script>
    <script src="https://ansible-labs-crew.github.io/js/hugo-learn.js?1632320281"></script>
    
        
            <script src="https://ansible-labs-crew.github.io/mermaid/mermaid.js?1632320281"></script>
        
        <script>
            mermaid.initialize({ startOnLoad: true });
        </script>
    
    

  </body>
</html>
